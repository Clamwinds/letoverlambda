{"version":3,"sources":["cursor.js"],"names":[],"mappings":"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","file":"cursor-compiled.js","sourcesContent":["\"use strict\";\n\n\nvar _prototypeProperties = function (child, staticProps, instanceProps) { if (staticProps) Object.defineProperties(child, staticProps); if (instanceProps) Object.defineProperties(child.prototype, instanceProps); };\n\nvar _inherits = function (subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) subClass.__proto__ = superClass; };\n\nvar _classCallCheck = function (instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } };\n\nvar _ = require(\"lodash\"),\n    Class = require(\"class-extend\"),\n    EventEmitter = require(\"events\").EventEmitter,\n    Q = require(\"bluebird\");\n\n\nvar RobeUtils = require(\"./utils\");\n\n\n\n/**\n * Represents a cursor which streams results.\n *\n * A `result` event will be emitted for each result.\n * An `error` event will be emitted for any errors.\n * A `success` event will be emitted once cursor completes.\n */\nvar Cursor = (function (EventEmitter) {\n  /**\n   * Constructor.\n   *\n   * @param  {Collection} collection Collection being queried.\n   * @param  {Promise} promise Promise returned from a monk `find()` call.\n   * @param  {Object} [options] Additional options.\n   * @param  {Boolean} [options.rawMode] Whether to enable raw query mode by default. Default is false.\n   */\n  function Cursor(collection, promise) {\n    var options = arguments[2] === undefined ? {} : arguments[2];\n    _classCallCheck(this, Cursor);\n\n    this.collection = collection;\n    this.promise = promise;\n    this.options = _.defaults(options, {\n      rawMode: false\n    });\n\n    this._init();\n  }\n\n  _inherits(Cursor, EventEmitter);\n\n  _prototypeProperties(Cursor, null, {\n    _init: {\n\n\n      /**\n       * Initialize events.\n       * @private\n       */\n      value: function _init() {\n        var self = this;\n\n        self.promise.on(\"each\", function (doc) {\n          doc = self.collection._createDocumentFromQueryResult(doc, self.options);\n\n          self.emit(\"result\", doc);\n        });\n\n        self.promise.on(\"error\", function (err) {\n          self.emit(\"error\", err);\n        });\n\n        self.promise.on(\"success\", function () {\n          self.emit(\"success\");\n        });\n      },\n      writable: true,\n      configurable: true\n    },\n    close: {\n\n\n      /**\n       * Close this cursor without waiting for it to finish.\n       */\n      value: function* close() {\n        var self = this;\n\n        yield new Q(function (resolve, reject) {\n          self.once(\"success\", resolve);\n\n          self.promise.destroy();\n        });\n      },\n      writable: true,\n      configurable: true\n    }\n  });\n\n  return Cursor;\n})(EventEmitter);\n\n\n\n\nCursor.extend = Class.extend;\n\nmodule.exports = Cursor;"]}