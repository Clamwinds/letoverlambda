{"version":3,"sources":["commands.js"],"names":[],"mappings":"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","file":"commands-compiled.js","sourcesContent":["var shared = require('./shared')\n  , utils = require('../utils')\n  , f = require('util').format\n  , DbCommand = require('../commands/db_command').DbCommand;\n\nvar stats = function stats(options, callback) {\n  var args = Array.prototype.slice.call(arguments, 0);\n  callback = args.pop();\n  // Fetch all commands\n  options = args.length ? args.shift() || {} : {};\n\n  // Build command object\n  var commandObject = {\n    collStats:this.collectionName,\n  }\n\n  // Check if we have the scale value\n  if(options['scale'] != null) commandObject['scale'] = options['scale'];\n\n  // Ensure we have the right read preference inheritance\n  options.readPreference = shared._getReadConcern(this, options);\n\n  // Execute the command\n  this.db.command(commandObject, options, callback);\n}\n\nvar count = function count(query, options, callback) {\n  var args = Array.prototype.slice.call(arguments, 0);\n  callback = args.pop();\n  query = args.length ? args.shift() || {} : {};\n  options = args.length ? args.shift() || {} : {};\n  var skip = options.skip;\n  var limit = options.limit;\n  var hint = options.hint;\n  var maxTimeMS = options.maxTimeMS;\n\n  // Final query\n  var cmd = {\n      'count': this.collectionName\n    , 'query': query\n    , 'fields': null\n  };\n\n  // Add limit and skip if defined\n  if(typeof skip == 'number') cmd.skip = skip;\n  if(typeof limit == 'number') cmd.limit = limit;\n  if(hint) cmd.hint = hint;\n\n  // Ensure we have the right read preference inheritance\n  options.readPreference = shared._getReadConcern(this, options);\n\n  // Execute the command\n  this.db.command(cmd, options, function(err, result) {\n    if(err) return callback(err);\n    callback(null, result.n);\n  });\n};\n\nvar distinct = function distinct(key, query, options, callback) {\n  var args = Array.prototype.slice.call(arguments, 1);\n  callback = args.pop();\n  query = args.length ? args.shift() || {} : {};\n  options = args.length ? args.shift() || {} : {};\n  var maxTimeMS = options.maxTimeMS;\n\n  var cmd = {\n      'distinct': this.collectionName\n    , 'key': key\n    , 'query': query\n  };\n\n  // Ensure we have the right read preference inheritance\n  options.readPreference = shared._getReadConcern(this, options);\n\n  // Execute the command\n  this.db.command(cmd, options, function(err, result) {\n    if(err) return callback(err);\n    callback(null, result.values);\n  });\n};\n\nvar rename = function rename (newName, options, callback) {\n  var self = this;\n  if(typeof options == 'function') {\n    callback = options;\n    options = {}\n  }\n\n  // Get collection class\n  var Collection = require('../collection').Collection;\n  // Ensure the new name is valid\n  shared.checkCollectionName(newName);\n  \n  // Build the command\n  var renameCollection = self.db.databaseName + \".\" + self.collectionName;\n  var toCollection = self.db.databaseName + \".\" + newName;\n  var dropTarget = typeof options.dropTarget == 'boolean' ? options.dropTarget : false;\n  var cmd = {'renameCollection':renameCollection, 'to':toCollection, 'dropTarget':dropTarget};\n\n  // Execute against admin\n  self.db.admin().command(cmd, options, function(err, result) {\n    if(err) return callback(err, null);\n    var doc = result.documents[0];\n    // We have an error\n    if(doc.errmsg) return callback(utils.toError(doc), null);\n    try {\n      return callback(null, new Collection(self.db, newName, self.db.pkFactory));\n    } catch(err) {\n      return callback(utils.toError(err), null);\n    }\n  });\n};\n\nvar options = function options(callback) {\n  var self = this;\n\n  self.db.listCollections({name: self.collectionName}).toArray(function(err, collections) {\n    if(err) return callback(err);\n    if(collections.length == 0) return callback(utils.toError(f(\"collection %s.%s not found\", self.db.databaseName, self.collectionName)));\n    callback(err, collections[0].options || null);      \n  });\n};\n\nvar isCapped = function isCapped(callback) {\n  this.options(function(err, document) {\n    if(err != null) {\n      callback(err);\n    } else {\n      callback(null, document && document.capped);\n    }\n  });\n};\n\nexports.stats = stats;\nexports.count = count;\nexports.distinct = distinct;\nexports.rename = rename;\nexports.options = options;\nexports.isCapped = isCapped;"]}