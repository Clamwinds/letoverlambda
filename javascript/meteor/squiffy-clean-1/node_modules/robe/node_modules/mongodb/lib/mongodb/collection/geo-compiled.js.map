{"version":3,"sources":["geo.js"],"names":[],"mappings":"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","file":"geo-compiled.js","sourcesContent":["var shared = require('./shared')\n  , utils = require('../utils');\n\nvar geoNear = function geoNear(x, y, options, callback) {\n  var point = typeof(x) == 'object' && x\n    , args = Array.prototype.slice.call(arguments, point?1:2);\n\n  callback = args.pop();\n  // Fetch all commands\n  options = args.length ? args.shift() || {} : {};\n\n  // Build command object\n  var commandObject = {\n    geoNear:this.collectionName,\n    near: point || [x, y]\n  }\n\n  // Ensure we have the right read preference inheritance\n  options.readPreference = shared._getReadConcern(this, options);\n\n  // Exclude readPreference and existing options to prevent user from\n  // shooting themselves in the foot\n  var exclude = {\n    readPreference: true,\n    geoNear: true,\n    near: true\n  };\n\n  commandObject = utils.decorateCommand(commandObject, options, exclude);\n\n  // Execute the command\n  this.db.command(commandObject, options, function (err, res) {\n    if (err) {\n      callback(err);\n    } else if (res.err || res.errmsg) {\n      callback(utils.toError(res));\n    } else {\n      // should we only be returning res.results here? Not sure if the user\n      // should see the other return information\n      callback(null, res);\n    }\n  });\n}\n\nvar geoHaystackSearch = function geoHaystackSearch(x, y, options, callback) {\n  var args = Array.prototype.slice.call(arguments, 2);\n  callback = args.pop();\n  // Fetch all commands\n  options = args.length ? args.shift() || {} : {};\n\n  // Build command object\n  var commandObject = {\n    geoSearch:this.collectionName,\n    near: [x, y]\n  }\n\n  // Remove read preference from hash if it exists\n  commandObject = utils.decorateCommand(commandObject, options, {readPreference: true});\n\n  // Ensure we have the right read preference inheritance\n  options.readPreference = shared._getReadConcern(this, options);\n\n  // Execute the command\n  this.db.command(commandObject, options, function (err, res) {\n    if (err) {\n      callback(err);\n    } else if (res.err || res.errmsg) {\n      callback(utils.toError(res));\n    } else {\n      // should we only be returning res.results here? Not sure if the user\n      // should see the other return information\n      callback(null, res);\n    }\n  });\n}\n\nexports.geoNear = geoNear;\nexports.geoHaystackSearch = geoHaystackSearch;\n"]}