{"version":3,"sources":["repl_set_state.js"],"names":[],"mappings":"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","file":"repl_set_state-compiled.js","sourcesContent":["/**\n * Interval state object constructor\n *\n * @ignore\n */\nvar ReplSetState = function ReplSetState (replset) {\n  this.errorMessages = [];\n  this.secondaries = {};\n  this.addresses = {};\n  this.arbiters = {};\n  this.passives = {};\n  this.members = [];\n  this.errors = {};\n  this.setName = null;\n  this.master = null;\n  this.replset = replset;\n}\n\nReplSetState.prototype.hasValidServers = function() {\n  var validServers = [];\n  if(this.master && this.master.isConnected()) return true;\n\n  if(this.secondaries) {\n    var keys = Object.keys(this.secondaries)\n    for(var i = 0; i < keys.length; i++) {\n      if(this.secondaries[keys[i]].isConnected())\n        return true;\n    }\n  }\n\n  return false;\n}\n\nReplSetState.prototype.getAllReadServers = function() {\n  var candidate_servers = [];\n  for(var name in this.addresses) {\n    candidate_servers.push(this.addresses[name]);\n  }\n\n  // Return all possible read candidates\n  return candidate_servers;\n}\n\nReplSetState.prototype.addServer = function(server, master) {\n  server.name = master.me;\n\n  if(master.ismaster) {\n    this.master = server;\n    this.addresses[server.name] = server;\n    this.replset.emit('joined', \"primary\", master, server);\n  } else if(master.secondary) {\n    this.secondaries[server.name] = server;\n    this.addresses[server.name] = server;\n    this.replset.emit('joined', \"secondary\", master, server);\n  } else if(master.arbiters) {\n    this.arbiters[server.name] = server;\n    this.addresses[server.name] = server;\n    this.replset.emit('joined', \"arbiter\", master, server);\n  }\n}\n\nReplSetState.prototype.contains = function(host) {\n  return this.addresses[host] != null;\n}\n\nReplSetState.prototype.isPrimary = function(server) {\n  return this.master && this.master.name == server.name;\n}\n\nReplSetState.prototype.isSecondary = function(server) {\n  return this.secondaries[server.name] != null;\n}\n\nexports.ReplSetState = ReplSetState;\n"]}