{"version":3,"sources":["mongo_reply.js"],"names":[],"mappings":"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","file":"mongo_reply-compiled.js","sourcesContent":["var Long = require('bson').Long\n  , timers = require('timers');\n\n// Set processor, setImmediate if 0.10 otherwise nextTick\nvar processor = require('../utils').processor();\n\n/**\n  Reply message from mongo db\n**/\nvar MongoReply = exports.MongoReply = function() {\n  this.documents = [];\n  this.index = 0;\n};\n\nMongoReply.prototype.parseHeader = function(binary_reply, bson) {\n  // Unpack the standard header first\n  this.messageLength = binary_reply[this.index] | binary_reply[this.index + 1] << 8 | binary_reply[this.index + 2] << 16 | binary_reply[this.index + 3] << 24;\n  this.index = this.index + 4;\n  // Fetch the request id for this reply\n  this.requestId = binary_reply[this.index] | binary_reply[this.index + 1] << 8 | binary_reply[this.index + 2] << 16 | binary_reply[this.index + 3] << 24;\n  this.index = this.index + 4;\n  // Fetch the id of the request that triggered the response\n  this.responseTo = binary_reply[this.index] | binary_reply[this.index + 1] << 8 | binary_reply[this.index + 2] << 16 | binary_reply[this.index + 3] << 24;\n  // Skip op-code field\n  this.index = this.index + 4 + 4;\n  // Unpack the reply message\n  this.responseFlag = binary_reply[this.index] | binary_reply[this.index + 1] << 8 | binary_reply[this.index + 2] << 16 | binary_reply[this.index + 3] << 24;\n  this.index = this.index + 4;\n  // Unpack the cursor id (a 64 bit long integer)\n  var low_bits = binary_reply[this.index] | binary_reply[this.index + 1] << 8 | binary_reply[this.index + 2] << 16 | binary_reply[this.index + 3] << 24;\n  this.index = this.index + 4;\n  var high_bits = binary_reply[this.index] | binary_reply[this.index + 1] << 8 | binary_reply[this.index + 2] << 16 | binary_reply[this.index + 3] << 24;\n  this.index = this.index + 4;\n  this.cursorId = new Long(low_bits, high_bits);\n  // Unpack the starting from\n  this.startingFrom = binary_reply[this.index] | binary_reply[this.index + 1] << 8 | binary_reply[this.index + 2] << 16 | binary_reply[this.index + 3] << 24;\n  this.index = this.index + 4;\n  // Unpack the number of objects returned\n  this.numberReturned = binary_reply[this.index] | binary_reply[this.index + 1] << 8 | binary_reply[this.index + 2] << 16 | binary_reply[this.index + 3] << 24;\n  this.index = this.index + 4;\n}\n\nMongoReply.prototype.parseBody = function(binary_reply, bson, raw, callback) {\n  raw = raw == null ? false : raw;\n\n  try {\n    // Let's unpack all the bson documents, deserialize them and store them\n    for(var object_index = 0; object_index < this.numberReturned; object_index++) {\n      var _options = {promoteLongs: bson.promoteLongs};\n      \n      // Read the size of the bson object\n      var bsonObjectSize = binary_reply[this.index] | binary_reply[this.index + 1] << 8 | binary_reply[this.index + 2] << 16 | binary_reply[this.index + 3] << 24;\n      \n      // If we are storing the raw responses to pipe straight through\n      if(raw) {\n        // Deserialize the object and add to the documents array\n        this.documents.push(binary_reply.slice(this.index, this.index + bsonObjectSize));\n      } else {\n        // Deserialize the object and add to the documents array\n        this.documents.push(bson.deserialize(binary_reply.slice(this.index, this.index + bsonObjectSize), _options));\n      }\n      \n      // Adjust binary index to point to next block of binary bson data\n      this.index = this.index + bsonObjectSize;\n    }\n    \n    // No error return\n    callback(null);\n  } catch(err) {\n    return callback(err);\n  }\n}\n\nMongoReply.prototype.is_error = function(){\n  if(this.documents.length == 1) {\n    return this.documents[0].ok == 1 ? false : true;\n  }\n  return false;\n};\n\nMongoReply.prototype.error_message = function() {\n  return this.documents.length == 1 && this.documents[0].ok == 1 ? '' : this.documents[0].errmsg;\n};"]}