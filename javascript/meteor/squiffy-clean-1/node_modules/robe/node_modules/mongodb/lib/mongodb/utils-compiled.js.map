{"version":3,"sources":["utils.js"],"names":[],"mappings":"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","file":"utils-compiled.js","sourcesContent":["var timers = require('timers');\n\n/**\n * Sort functions, Normalize and prepare sort parameters\n */\nvar formatSortValue = exports.formatSortValue = function(sortDirection) {\n  var value = (\"\" + sortDirection).toLowerCase();\n\n  switch (value) {\n    case 'ascending':\n    case 'asc':\n    case '1':\n      return 1;\n    case 'descending':\n    case 'desc':\n    case '-1':\n      return -1;\n    default:\n      throw new Error(\"Illegal sort clause, must be of the form \"\n                    + \"[['field1', '(ascending|descending)'], \"\n                    + \"['field2', '(ascending|descending)']]\");\n  }\n};\n\nvar formattedOrderClause = exports.formattedOrderClause = function(sortValue) {\n  var orderBy = {};\n  if(sortValue == null) return null;\n  if (Array.isArray(sortValue)) {\n    if(sortValue.length === 0) {\n      return null;\n    }\n\n    for(var i = 0; i < sortValue.length; i++) {\n      if(sortValue[i].constructor == String) {\n        orderBy[sortValue[i]] = 1;\n      } else {\n        orderBy[sortValue[i][0]] = formatSortValue(sortValue[i][1]);\n      }      \n    }\n  } else if(sortValue != null && typeof sortValue == 'object') {\n    orderBy = sortValue;\n  } else if (typeof sortValue == 'string') {\n    orderBy[sortValue] = 1;\n  } else {\n    throw new Error(\"Illegal sort clause, must be of the form \" +\n      \"[['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]\");\n  }\n\n  return orderBy;\n};\n\nexports.encodeInt = function(value) {\n  var buffer = new Buffer(4);\n  buffer[3] = (value >> 24) & 0xff;      \n  buffer[2] = (value >> 16) & 0xff;\n  buffer[1] = (value >> 8) & 0xff;\n  buffer[0] = value & 0xff;\n  return buffer;\n}\n\nexports.encodeIntInPlace = function(value, buffer, index) {\n  buffer[index + 3] = (value >> 24) & 0xff;\t\t\t\n\tbuffer[index + 2] = (value >> 16) & 0xff;\n\tbuffer[index + 1] = (value >> 8) & 0xff;\n\tbuffer[index] = value & 0xff;\n}\n\nexports.encodeCString = function(string) {\n  var buf = new Buffer(string, 'utf8');\n  return [buf, new Buffer([0])];\n}\n\nexports.decodeUInt32 = function(array, index) {\n  return array[index] | array[index + 1] << 8 | array[index + 2] << 16 | array[index + 3] << 24;\n}\n\n// Decode the int\nexports.decodeUInt8 = function(array, index) {\n  return array[index];\n}\n\n/**\n * Context insensitive type checks\n */\n\nvar toString = Object.prototype.toString;\n\nvar isObject = exports.isObject = function (arg) {\n  return '[object Object]' == toString.call(arg)\n}\n\nexports.isArray = function (arg) {\n  return Array.isArray(arg) ||\n    'object' == typeof arg && '[object Array]' == toString.call(arg)\n}\n\nexports.isDate = function (arg) {\n  return 'object' == typeof arg && '[object Date]' == toString.call(arg)\n}\n\nexports.isRegExp = function (arg) {\n  return 'object' == typeof arg && '[object RegExp]' == toString.call(arg)\n}\n\n/**\n * Wrap a Mongo error document in an Error instance\n * @ignore\n * @api private\n */\nvar toError = function(error) {\n  if (error instanceof Error) return error;\n\n  var msg = error.err || error.errmsg || error.errMessage || error.$err || error;\n  var e = new Error(msg);\n  e.name = 'MongoError';\n\n  // Get all object keys\n  var keys = typeof error == 'object'\n    ? Object.keys(error)\n    : [];\n\n  for(var i = 0; i < keys.length; i++) {\n    e[keys[i]] = error[keys[i]];\n  }\n\n  return e;\n}\nexports.toError = toError;\n\n/**\n * Convert a single level object to an array\n * @ignore\n * @api private\n */\nexports.objectToArray = function(object) {\n  var list = [];\n\n  for(var name in object) {\n    list.push(object[name])\n  }\n\n  return list;\n}\n\n/**\n * Handle single command document return\n * @ignore\n * @api private\n */\nexports.handleSingleCommandResultReturn = function(override_value_true, override_value_false, callback) {\n  return function(err, result, connection) {\n    if(callback == null) return;\n    if(err && typeof callback == 'function') return callback(err, null);\n    if(!result || !result.documents || result.documents.length == 0)\n      if(typeof callback == 'function') return callback(toError(\"command failed to return results\"), null)\n    if(result && result.documents[0].ok == 1) {\n      if(override_value_true) return callback(null, override_value_true)\n      if(typeof callback == 'function') return callback(null, result.documents[0]);\n    }\n\n    // Return the error from the document\n    if(typeof callback == 'function') return callback(toError(result.documents[0]), override_value_false);    \n  }\n}\n\n/**\n * Return correct processor\n * @ignore\n * @api private\n */\nexports.processor = function() {\n  // Set processor, setImmediate if 0.10 otherwise nextTick\n  process.maxTickDepth = Infinity;\n  // Only use nextTick\n  return process.nextTick;\n}\n\n/**\n * Allow setting the socketTimeoutMS on all connections\n * to work around issues such as secondaries blocking due to compaction\n *\n * @ignore\n * @api private\n */\nexports.setSocketTimeoutProperty = function(self, options) {\n  Object.defineProperty(self, \"socketTimeoutMS\", {\n      enumerable: true\n    , get: function () { return options.socketTimeoutMS; }\n    , set: function (value) { \n      // Set the socket timeoutMS value\n      options.socketTimeoutMS = value;\n\n      // Get all the connections\n      var connections = self.allRawConnections();\n      for(var i = 0; i < connections.length; i++) {\n        connections[i].socketTimeoutMS = value;\n      }\n    }\n  });  \n}\n\n/**\n * Determine if the server supports write commands\n *\n * @ignore\n * @api private\n */\nexports.hasWriteCommands = function(connection) {\n  return connection != null && connection.serverCapabilities != null && connection.serverCapabilities.hasWriteCommands;\n}\n\n/**\n * Fetch server capabilities\n *\n * @ignore\n * @api private\n */\nexports.serverCapabilities = function(connection) {\n  return connection != null && connection.serverCapabilities != null && connection.serverCapabilities.hasWriteCommands;\n}\n\n/**\n * Create index name based on field spec\n *\n * @ignore\n * @api private\n */\nexports.parseIndexOptions = function(fieldOrSpec) {\n  var fieldHash = {};\n  var indexes = [];\n  var keys;\n\n  // Get all the fields accordingly\n  if('string' == typeof fieldOrSpec) {\n    // 'type'\n    indexes.push(fieldOrSpec + '_' + 1);\n    fieldHash[fieldOrSpec] = 1;\n  } else if(Array.isArray(fieldOrSpec)) {\n    fieldOrSpec.forEach(function(f) {\n      if('string' == typeof f) {\n        // [{location:'2d'}, 'type']\n        indexes.push(f + '_' + 1);\n        fieldHash[f] = 1;\n      } else if(Array.isArray(f)) {\n        // [['location', '2d'],['type', 1]]\n        indexes.push(f[0] + '_' + (f[1] || 1));\n        fieldHash[f[0]] = f[1] || 1;\n      } else if(isObject(f)) {\n        // [{location:'2d'}, {type:1}]\n        keys = Object.keys(f);\n        keys.forEach(function(k) {\n          indexes.push(k + '_' + f[k]);\n          fieldHash[k] = f[k];\n        });\n      } else {\n        // undefined (ignore)\n      }\n    });\n  } else if(isObject(fieldOrSpec)) {\n    // {location:'2d', type:1}\n    keys = Object.keys(fieldOrSpec);\n    keys.forEach(function(key) {\n      indexes.push(key + '_' + fieldOrSpec[key]);\n      fieldHash[key] = fieldOrSpec[key];\n    });\n  }\n\n  return {\n    name: indexes.join(\"_\"), keys: keys, fieldHash: fieldHash\n  }\n}\n\nexports.decorateCommand = function(command, options, exclude) {\n  for(var name in options) {\n    if(exclude[name] == null) command[name] = options[name];\n  }\n\n  return command;\n}\n\nexports.shallowObjectCopy = function(object) {\n  var c = {};\n  for(var n in object) c[n] = object[n];\n  return c;\n}\n\n"]}