{"version":3,"sources":["query.js"],"names":[],"mappings":"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","file":"query-compiled.js","sourcesContent":["var ObjectID = require('bson').ObjectID\n  , Long = require('bson').Long\n  , DbCommand = require('../commands/db_command').DbCommand\n  , CommandCursor = require('../command_cursor').CommandCursor\n  , Scope = require('../scope').Scope\n  , shared = require('./shared')\n  , utils = require('../utils');\n\nvar testForFields = {\n    limit: 1, sort: 1, fields:1, skip: 1, hint: 1, explain: 1, snapshot: 1, timeout: 1, tailable: 1, tailableRetryInterval: 1\n  , numberOfRetries: 1, awaitdata: 1, exhaust: 1, batchSize: 1, returnKey: 1, maxScan: 1, min: 1, max: 1, showDiskLoc: 1\n  , comment: 1, raw: 1, readPreference: 1, partial: 1, read: 1, dbName: 1, oplogReplay: 1, connection: 1\n};\n\n//\n// Find method\n//\nvar find = function find () {\n  var options\n    , args = Array.prototype.slice.call(arguments, 0)\n    , has_callback = typeof args[args.length - 1] === 'function'\n    , has_weird_callback = typeof args[0] === 'function'\n    , callback = has_callback ? args.pop() : (has_weird_callback ? args.shift() : null)\n    , len = args.length\n    , selector = len >= 1 ? args[0] : {}\n    , fields = len >= 2 ? args[1] : undefined;\n\n  if(len === 1 && has_weird_callback) {\n    // backwards compat for callback?, options case\n    selector = {};\n    options = args[0];\n  }\n\n  if(len === 2 && !Array.isArray(fields)) {\n    var fieldKeys = Object.getOwnPropertyNames(fields);\n    var is_option = false;\n\n    for(var i = 0; i < fieldKeys.length; i++) {\n      if(testForFields[fieldKeys[i]] != null) {\n        is_option = true;\n        break;\n      }\n    }\n\n    if(is_option) {\n      options = fields;\n      fields = undefined;\n    } else {\n      options = {};\n    }\n  } else if(len === 2 && Array.isArray(fields) && !Array.isArray(fields[0])) {\n    var newFields = {};\n    // Rewrite the array\n    for(var i = 0; i < fields.length; i++) {\n      newFields[fields[i]] = 1;\n    }\n    // Set the fields\n    fields = newFields;\n  }\n\n  if(3 === len) {\n    options = args[2];\n  }\n\n  // Ensure selector is not null\n  selector = selector == null ? {} : selector;\n  // Validate correctness off the selector\n  var object = selector;\n  if(Buffer.isBuffer(object)) {\n    var object_size = object[0] | object[1] << 8 | object[2] << 16 | object[3] << 24;\n    if(object_size != object.length)  {\n      var error = new Error(\"query selector raw message size does not match message header size [\" + object.length + \"] != [\" + object_size + \"]\");\n      error.name = 'MongoError';\n      throw error;\n    }\n  }\n\n  // Validate correctness of the field selector\n  var object = fields;\n  if(Buffer.isBuffer(object)) {\n    var object_size = object[0] | object[1] << 8 | object[2] << 16 | object[3] << 24;\n    if(object_size != object.length)  {\n      var error = new Error(\"query fields raw message size does not match message header size [\" + object.length + \"] != [\" + object_size + \"]\");\n      error.name = 'MongoError';\n      throw error;\n    }\n  }\n\n  // Check special case where we are using an objectId\n  if(selector instanceof ObjectID || (selector != null && selector._bsontype == 'ObjectID')) {\n    selector = {_id:selector};\n  }\n\n  // If it's a serialized fields field we need to just let it through\n  // user be warned it better be good\n  if(options && options.fields && !(Buffer.isBuffer(options.fields))) {\n    fields = {};\n\n    if(Array.isArray(options.fields)) {\n      if(!options.fields.length) {\n        fields['_id'] = 1;\n      } else {\n        for (var i = 0, l = options.fields.length; i < l; i++) {\n          fields[options.fields[i]] = 1;\n        }\n      }\n    } else {\n      fields = options.fields;\n    }\n  }\n\n  if (!options) options = {};\n\n  var newOptions = {};\n  // Make a shallow copy of options\n  for (var key in options) {\n    newOptions[key] = options[key];\n  }\n\n  newOptions.skip = len > 3 ? args[2] : options.skip ? options.skip : 0;\n  newOptions.limit = len > 3 ? args[3] : options.limit ? options.limit : 0;\n  newOptions.raw = options.raw != null && typeof options.raw === 'boolean' ? options.raw : this.raw;\n  newOptions.hint = options.hint != null ? shared.normalizeHintField(options.hint) : this.internalHint;\n  newOptions.timeout = len == 5 ? args[4] : typeof options.timeout === 'undefined' ? undefined : options.timeout;\n  // If we have overridden slaveOk otherwise use the default db setting\n  newOptions.slaveOk = options.slaveOk != null ? options.slaveOk : this.db.slaveOk;\n\n  // Set option\n  var o = newOptions;\n  // Support read/readPreference\n  if(o[\"read\"] != null) o[\"readPreference\"] = o[\"read\"];\n  // If no readPreference specified set the collection level readPreference\n  o.readPreference = o.readPreference ? o.readPreference : this.readPreference;\n  // If still no readPreference specified set the db level\n  o.readPreference = o.readPreference ? o.readPreference : this.db.options.readPreference;\n  // Set slaveok if needed\n  if(o.readPreference == \"secondary\" || o.read == \"secondaryOnly\") o.slaveOk = true;\n\n  // Set the selector\n  o.selector = selector;  \n\n  // Create precursor\n  var scope = new Scope(this, {}, fields, o);\n  // Callback for backward compatibility\n  if(callback) return callback(null, scope.find(selector));\n  // Return the pre cursor object\n  return scope.find(selector);\n};\n\nvar findOne = function findOne () {\n  var self = this;\n  var args = Array.prototype.slice.call(arguments, 0);\n  var callback = args.pop();\n  var cursor = this.find.apply(this, args).limit(-1).batchSize(1);\n  \n  // Return the item\n  cursor.nextObject(function(err, item) {\n    if(err != null) return callback(utils.toError(err), null);\n    callback(null, item);\n  });\n};\n\nvar parallelCollectionScan = function parallelCollectionScan (options, callback) {  \n  var self = this;\n  \n  if(typeof options == 'function') {\n    callback = options;\n    options = {numCursors: 1};\n  }\n\n  // Set number of cursors to 1\n  options.numCursors = options.numCursors || 1;\n  options.batchSize = options.batchSize || 1000;\n\n  // Set read preference if we set one\n  options.readPreference = shared._getReadConcern(this, options);\n  \n  // Create command object\n  var commandObject = {\n      parallelCollectionScan: this.collectionName\n    , numCursors: options.numCursors\n  }\n\n  // Execute the command\n  this.db.command(commandObject, options, function(err, result) {\n    if(err) return callback(err, null);\n    if(result == null) return callback(new Error(\"no result returned for parallelCollectionScan\"), null);\n\n    var cursors = [];\n    // Create command cursors for each item\n    for(var i = 0; i < result.cursors.length; i++) {\n      var rawId = result.cursors[i].cursor.id\n      // Convert cursorId to Long if needed\n      var cursorId = typeof rawId == 'number' ? Long.fromNumber(rawId) : rawId;\n\n      // Command cursor options\n      var commandOptions = {\n          batchSize: options.batchSize\n        , cursorId: cursorId\n        , items: result.cursors[i].cursor.firstBatch\n      }\n\n      // Add a command cursor\n      cursors.push(new CommandCursor(self.db, self, {}, commandOptions));\n    }\n\n    callback(null, cursors);\n  });\n}\n\nexports.find = find;\nexports.findOne = findOne;\nexports.parallelCollectionScan = parallelCollectionScan;\n"]}