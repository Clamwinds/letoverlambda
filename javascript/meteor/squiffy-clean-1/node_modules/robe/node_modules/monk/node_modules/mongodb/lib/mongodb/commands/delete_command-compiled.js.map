{"version":3,"sources":["delete_command.js"],"names":[],"mappings":"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","file":"delete_command-compiled.js","sourcesContent":["var BaseCommand = require('./base_command').BaseCommand,\n  inherits = require('util').inherits;\n\n/**\n  Insert Document Command\n**/\nvar DeleteCommand = exports.DeleteCommand = function(db, collectionName, selector, flags) {\n  BaseCommand.call(this);\n\n  // Validate correctness off the selector\n  var object = selector;\n  if(Buffer.isBuffer(object)) {\n    var object_size = object[0] | object[1] << 8 | object[2] << 16 | object[3] << 24;        \n    if(object_size != object.length)  {\n      var error = new Error(\"delete raw message size does not match message header size [\" + object.length + \"] != [\" + object_size + \"]\");\n      error.name = 'MongoError';\n      throw error;\n    }\n  }\n  \n  this.flags = flags;\n  this.collectionName = collectionName;\n  this.selector = selector;\n  this.db = db;\n};\n\ninherits(DeleteCommand, BaseCommand);\n\nDeleteCommand.OP_DELETE =\t2006;\n\n/*\nstruct {\n    MsgHeader header;                 // standard message header\n    int32     ZERO;                   // 0 - reserved for future use\n    cstring   fullCollectionName;     // \"dbname.collectionname\"\n    int32     ZERO;                   // 0 - reserved for future use\n    mongo.BSON      selector;               // query object.  See below for details.\n}\n*/\nDeleteCommand.prototype.toBinary = function(bsonSettings) {\n  // Validate that we are not passing 0x00 in the colletion name\n  if(!!~this.collectionName.indexOf(\"\\x00\")) {\n    throw new Error(\"namespace cannot contain a null character\");\n  }\n\n  // Calculate total length of the document\n  var totalLengthOfCommand = 4 + Buffer.byteLength(this.collectionName) + 1 + 4 + this.db.bson.calculateObjectSize(this.selector, false, true) + (4 * 4);\n  \n  // Enforce maximum bson size\n  if(!bsonSettings.disableDriverBSONSizeCheck \n    && totalLengthOfCommand > bsonSettings.maxBsonSize) \n    throw new Error(\"Document exceeds maximum allowed bson size of \" + bsonSettings.maxBsonSize + \" bytes\");\n\n  if(bsonSettings.disableDriverBSONSizeCheck \n    && totalLengthOfCommand > bsonSettings.maxMessageSizeBytes) \n    throw new Error(\"Command exceeds maximum message size of \" + bsonSettings.maxMessageSizeBytes + \" bytes\");\n\n  // Let's build the single pass buffer command\n  var _index = 0;\n  var _command = new Buffer(totalLengthOfCommand);\n  // Write the header information to the buffer\n  _command[_index + 3] = (totalLengthOfCommand >> 24) & 0xff;     \n  _command[_index + 2] = (totalLengthOfCommand >> 16) & 0xff;\n  _command[_index + 1] = (totalLengthOfCommand >> 8) & 0xff;\n  _command[_index] = totalLengthOfCommand & 0xff;\n  // Adjust index\n  _index = _index + 4;\n  // Write the request ID\n  _command[_index + 3] = (this.requestId >> 24) & 0xff;     \n  _command[_index + 2] = (this.requestId >> 16) & 0xff;\n  _command[_index + 1] = (this.requestId >> 8) & 0xff;\n  _command[_index] = this.requestId & 0xff;\n  // Adjust index\n  _index = _index + 4;\n  // Write zero\n  _command[_index++] = 0;\n  _command[_index++] = 0;\n  _command[_index++] = 0;\n  _command[_index++] = 0;\n  // Write the op_code for the command\n  _command[_index + 3] = (DeleteCommand.OP_DELETE >> 24) & 0xff;     \n  _command[_index + 2] = (DeleteCommand.OP_DELETE >> 16) & 0xff;\n  _command[_index + 1] = (DeleteCommand.OP_DELETE >> 8) & 0xff;\n  _command[_index] = DeleteCommand.OP_DELETE & 0xff;\n  // Adjust index\n  _index = _index + 4;\n\n  // Write zero\n  _command[_index++] = 0;\n  _command[_index++] = 0;\n  _command[_index++] = 0;\n  _command[_index++] = 0;\n\n  // Write the collection name to the command\n  _index = _index + _command.write(this.collectionName, _index, 'utf8') + 1;\n  _command[_index - 1] = 0;    \n\n  // Write the flags\n  _command[_index + 3] = (this.flags >> 24) & 0xff;     \n  _command[_index + 2] = (this.flags >> 16) & 0xff;\n  _command[_index + 1] = (this.flags >> 8) & 0xff;\n  _command[_index] = this.flags & 0xff;\n  // Adjust index\n  _index = _index + 4;\n\n  // Document binary length\n  var documentLength = 0\n\n  // Serialize the selector\n  // If we are passing a raw buffer, do minimal validation\n  if(Buffer.isBuffer(this.selector)) {\n    documentLength = this.selector.length;\n    // Copy the data into the current buffer\n    this.selector.copy(_command, _index);\n  } else {\n    documentLength = this.db.bson.serializeWithBufferAndIndex(this.selector, false, _command, _index) - _index + 1;\n  }\n  \n  // Write the length to the document\n  _command[_index + 3] = (documentLength >> 24) & 0xff;     \n  _command[_index + 2] = (documentLength >> 16) & 0xff;\n  _command[_index + 1] = (documentLength >> 8) & 0xff;\n  _command[_index] = documentLength & 0xff;\n  // Update index in buffer\n  _index = _index + documentLength;\n  // Add terminating 0 for the object\n  _command[_index - 1] = 0;      \n  return _command;\n};"]}