{"version":3,"sources":["gridstore.js"],"names":[],"mappings":"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","file":"gridstore-compiled.js","sourcesContent":["/**\n * @fileOverview GridFS is a tool for MongoDB to store files to the database.\n * Because of the restrictions of the object size the database can hold, a\n * facility to split a file into several chunks is needed. The {@link GridStore}\n * class offers a simplified api to interact with files while managing the\n * chunks of split files behind the scenes. More information about GridFS can be\n * found <a href=\"http://www.mongodb.org/display/DOCS/GridFS\">here</a>.\n */\nvar Chunk = require('./chunk').Chunk,\n  DbCommand = require('../commands/db_command').DbCommand,\n  ObjectID = require('bson').ObjectID,\n  Buffer = require('buffer').Buffer,\n  fs = require('fs'),\n  timers = require('timers'),\n  util = require('util'),\n  inherits = util.inherits,\n  ReadStream = require('./readstream').ReadStream,\n  Stream = require('stream');\n\n// Set processor, setImmediate if 0.10 otherwise nextTick\nvar processor = require('../utils').processor();\n\nvar REFERENCE_BY_FILENAME = 0,\n  REFERENCE_BY_ID = 1;\n\n/**\n * A class representation of a file stored in GridFS.\n *\n * Modes\n *  - **\"r\"** - read only. This is the default mode.\n *  - **\"w\"** - write in truncate mode. Existing data will be overwriten.\n *  - **w+\"** - write in edit mode (append is not guaranteed for concurrent operations)\n *\n * Options\n *  - **root** {String}, root collection to use. Defaults to **{GridStore.DEFAULT_ROOT_COLLECTION}**.\n *  - **content_type** {String}, mime type of the file. Defaults to **{GridStore.DEFAULT_CONTENT_TYPE}**.\n *  - **chunk_size** {Number}, size for the chunk. Defaults to **{Chunk.DEFAULT_CHUNK_SIZE}**.\n *  - **metadata** {Object}, arbitrary data the user wants to store.\n *  - **readPreference** {String}, the prefered read preference (ReadPreference.PRIMARY, ReadPreference.PRIMARY_PREFERRED, ReadPreference.SECONDARY, ReadPreference.SECONDARY_PREFERRED, ReadPreference.NEAREST).\n *  - **w**, {Number/String, > -1 || 'majority' || tag name} the write concern for the operation where < 1 is no acknowlegement of write and w >= 1, w = 'majority' or tag acknowledges the write\n *  - **wtimeout**, {Number, 0} set the timeout for waiting for write concern to finish (combines with w option)\n *  - **fsync**, (Boolean, default:false) write waits for fsync before returning, from MongoDB 2.6 on, fsync cannot be combined with journal\n *  - **j**, (Boolean, default:false) write waits for journal sync before returning\n *\n * @class Represents the GridStore.\n * @param {Db} db A database instance to interact with.\n * @param {Any} [id] optional unique id for this file\n * @param {String} [filename] optional filename for this file, no unique constrain on the field\n * @param {String} mode set the mode for this file.\n * @param {Object} options optional properties to specify.\n * @return {GridStore}\n */\nvar GridStore = function GridStore(db, id, filename, mode, options) {\n  if(!(this instanceof GridStore)) return new GridStore(db, id, filename, mode, options);\n\n  var self = this;\n  this.db = db;\n\n  // Call stream constructor\n  if(typeof Stream == 'function') {\n    Stream.call(this);\n  }\n\n  // Handle options\n  if(typeof options === 'undefined') options = {};\n  // Handle mode\n  if(typeof mode === 'undefined') {\n    mode = filename;\n    filename = undefined;\n  } else if(typeof mode == 'object') {\n    options = mode;\n    mode = filename;\n    filename = undefined;\n  }\n\n  if(id instanceof ObjectID) {\n    this.referenceBy = REFERENCE_BY_ID;\n    this.fileId = id;\n    this.filename = filename;\n  } else if(typeof filename == 'undefined') {\n    this.referenceBy = REFERENCE_BY_FILENAME;\n    this.filename = id;\n    if (mode.indexOf('w') != null) {\n      this.fileId = new ObjectID();\n    }\n  } else {\n    this.referenceBy = REFERENCE_BY_ID;\n    this.fileId = id;\n    this.filename = filename;\n  }\n\n  // Set up the rest\n  this.mode = mode == null ? \"r\" : mode;\n  this.options = options || {};\n\n  // Set the root if overridden\n  this.root = this.options['root'] == null ? exports.GridStore.DEFAULT_ROOT_COLLECTION : this.options['root'];\n  this.position = 0;\n  this.readPreference = this.options.readPreference || 'primary';\n  this.writeConcern = _getWriteConcern(db, this.options);\n  // Set default chunk size\n  this.internalChunkSize = this.options['chunkSize'] == null ? Chunk.DEFAULT_CHUNK_SIZE : this.options['chunkSize'];\n}\n\n/**\n *  Code for the streaming capabilities of the gridstore object\n *  Most code from Aaron heckmanns project https://github.com/aheckmann/gridfs-stream\n *  Modified to work on the gridstore object itself\n *  @ignore\n */\nif(typeof Stream == 'function') {\n  GridStore.prototype = { __proto__: Stream.prototype }\n} else {\n  // Node 0.4.X compatibility code\n  GridStore.prototype = { __proto__: Stream.Stream.prototype }\n}\n\n// Move pipe to _pipe\nGridStore.prototype._pipe = GridStore.prototype.pipe;\n\n/**\n * Opens the file from the database and initialize this object. Also creates a\n * new one if file does not exist.\n *\n * @param {Function} callback this will be called after executing this method. The first parameter will contain an **{Error}** object and the second parameter will be null if an error occured. Otherwise, the first parameter will be null and the second will contain the reference to this object.\n * @return {null}\n * @api public\n */\nGridStore.prototype.open = function(callback) {\n  if( this.mode != \"w\" && this.mode != \"w+\" && this.mode != \"r\"){\n    callback(new Error(\"Illegal mode \" + this.mode), null);\n    return;\n  }\n\n  var self = this;\n\n  // Get the write concern\n  var writeConcern = _getWriteConcern(this.db, this.options);\n\n  // If we are writing we need to ensure we have the right indexes for md5's\n  if((self.mode == \"w\" || self.mode == \"w+\")) {\n    // Get files collection\n    var collection = self.collection();\n    // Put index on filename\n    collection.ensureIndex([['filename', 1]], writeConcern, function(err, index) {\n      if(err) return callback(err);\n\n      // Get chunk collection\n      var chunkCollection = self.chunkCollection();\n      // Ensure index on chunk collection\n      chunkCollection.ensureIndex([['files_id', 1], ['n', 1]], writeConcern, function(err, index) {\n        if(err) return callback(err);\n        _open(self, writeConcern, callback);\n      });\n    });\n  } else {\n    // Open the gridstore\n    _open(self, writeConcern, callback);\n  }\n};\n\n/**\n * Hidding the _open function\n * @ignore\n * @api private\n */\nvar _open = function(self, options, callback) {\n  var collection = self.collection();\n  // Create the query\n  var query = self.referenceBy == REFERENCE_BY_ID ? {_id:self.fileId} : {filename:self.filename};\n  query = null == self.fileId && self.filename == null ? null : query;\n  options.readPreference = self.readPreference;\n\n  // Fetch the chunks\n  if(query != null) {\n    collection.find(query, options, function(err, cursor) {\n      if(err) return error(err);\n\n      // Fetch the file\n      cursor.nextObject(function(err, doc) {\n        if(err) return error(err);\n\n        // Check if the collection for the files exists otherwise prepare the new one\n        if(doc != null) {\n          self.fileId = doc._id;\n          // Prefer a new filename over the existing one if this is a write\n          self.filename = ((self.mode == 'r') || (self.filename == undefined)) ? doc.filename : self.filename;\n          self.contentType = doc.contentType;\n          self.internalChunkSize = doc.chunkSize;\n          self.uploadDate = doc.uploadDate;\n          self.aliases = doc.aliases;\n          self.length = doc.length;\n          self.metadata = doc.metadata;\n          self.internalMd5 = doc.md5;\n        } else if (self.mode != 'r') {\n          self.fileId = self.fileId == null ? new ObjectID() : self.fileId;\n          self.contentType = exports.GridStore.DEFAULT_CONTENT_TYPE;\n          self.internalChunkSize = self.internalChunkSize == null ? Chunk.DEFAULT_CHUNK_SIZE : self.internalChunkSize;\n          self.length = 0;\n        } else {\n          self.length = 0;\n          var txtId = self.fileId instanceof ObjectID ? self.fileId.toHexString() : self.fileId;\n          return error(new Error((self.referenceBy == REFERENCE_BY_ID ? txtId : self.filename) + \" does not exist\", self));\n        }\n\n        // Process the mode of the object\n        if(self.mode == \"r\") {\n          nthChunk(self, 0, options, function(err, chunk) {\n            if(err) return error(err);\n            self.currentChunk = chunk;\n            self.position = 0;\n            callback(null, self);\n          });\n        } else if(self.mode == \"w\") {\n          // Delete any existing chunks\n          deleteChunks(self, options, function(err, result) {\n            if(err) return error(err);\n            self.currentChunk = new Chunk(self, {'n':0}, self.writeConcern);\n            self.contentType = self.options['content_type'] == null ? self.contentType : self.options['content_type'];\n            self.internalChunkSize = self.options['chunk_size'] == null ? self.internalChunkSize : self.options['chunk_size'];\n            self.metadata = self.options['metadata'] == null ? self.metadata : self.options['metadata'];\n            self.aliases = self.options['aliases'] == null ? self.aliases : self.options['aliases'];\n            self.position = 0;\n            callback(null, self);\n          });\n        } else if(self.mode == \"w+\") {\n          nthChunk(self, lastChunkNumber(self), options, function(err, chunk) {\n            if(err) return error(err);\n            // Set the current chunk\n            self.currentChunk = chunk == null ? new Chunk(self, {'n':0}, self.writeConcern) : chunk;\n            self.currentChunk.position = self.currentChunk.data.length();\n            self.metadata = self.options['metadata'] == null ? self.metadata : self.options['metadata'];\n            self.aliases = self.options['aliases'] == null ? self.aliases : self.options['aliases'];\n            self.position = self.length;\n            callback(null, self);\n          });\n        }\n      });\n    });\n  } else {\n    // Write only mode\n    self.fileId = null == self.fileId ? new ObjectID() : self.fileId;\n    self.contentType = exports.GridStore.DEFAULT_CONTENT_TYPE;\n    self.internalChunkSize = self.internalChunkSize == null ? Chunk.DEFAULT_CHUNK_SIZE : self.internalChunkSize;\n    self.length = 0;\n\n    var collection2 = self.chunkCollection();\n    // No file exists set up write mode\n    if(self.mode == \"w\") {\n      // Delete any existing chunks\n      deleteChunks(self, options, function(err, result) {\n        if(err) return error(err);\n        self.currentChunk = new Chunk(self, {'n':0}, self.writeConcern);\n        self.contentType = self.options['content_type'] == null ? self.contentType : self.options['content_type'];\n        self.internalChunkSize = self.options['chunk_size'] == null ? self.internalChunkSize : self.options['chunk_size'];\n        self.metadata = self.options['metadata'] == null ? self.metadata : self.options['metadata'];\n        self.aliases = self.options['aliases'] == null ? self.aliases : self.options['aliases'];\n        self.position = 0;\n        callback(null, self);\n      });\n    } else if(self.mode == \"w+\") {\n      nthChunk(self, lastChunkNumber(self), options, function(err, chunk) {\n        if(err) return error(err);\n        // Set the current chunk\n        self.currentChunk = chunk == null ? new Chunk(self, {'n':0}, self.writeConcern) : chunk;\n        self.currentChunk.position = self.currentChunk.data.length();\n        self.metadata = self.options['metadata'] == null ? self.metadata : self.options['metadata'];\n        self.aliases = self.options['aliases'] == null ? self.aliases : self.options['aliases'];\n        self.position = self.length;\n        callback(null, self);\n      });\n    }\n  }\n\n  // only pass error to callback once\n  function error (err) {\n    if(error.err) return;\n    callback(error.err = err);\n  }\n};\n\n/**\n * Stores a file from the file system to the GridFS database.\n *\n * @param {String|Buffer|FileHandle} file the file to store.\n * @param {Function} callback this will be called after this method is executed. The first parameter will be null and the the second will contain the reference to this object.\n * @return {null}\n * @api public\n */\nGridStore.prototype.writeFile = function (file, callback) {\n  var self = this;\n  if (typeof file === 'string') {\n    fs.open(file, 'r', function (err, fd) {\n      if(err) return callback(err);\n      self.writeFile(fd, callback);\n    });\n    return;\n  }\n\n  self.open(function (err, self) {\n    if(err) return callback(err, self);\n\n    fs.fstat(file, function (err, stats) {\n      if(err) return callback(err, self);\n\n      var offset = 0;\n      var index = 0;\n      var numberOfChunksLeft = Math.min(stats.size / self.chunkSize);\n\n      // Write a chunk\n      var writeChunk = function() {\n        fs.read(file, self.chunkSize, offset, 'binary', function(err, data, bytesRead) {\n          if(err) return callback(err, self);\n\n          offset = offset + bytesRead;\n\n          // Create a new chunk for the data\n          var chunk = new Chunk(self, {n:index++}, self.writeConcern);\n          chunk.write(data, function(err, chunk) {\n            if(err) return callback(err, self);\n\n            chunk.save({}, function(err, result) {\n              if(err) return callback(err, self);\n\n              self.position = self.position + data.length;\n\n              // Point to current chunk\n              self.currentChunk = chunk;\n\n              if(offset >= stats.size) {\n                fs.close(file);\n                self.close(function(err, result) {\n                  if(err) return callback(err, self);\n                  return callback(null, self);\n                });\n              } else {\n                return processor(writeChunk);\n              }\n            });\n          });\n        });\n      }\n\n      // Process the first write\n      processor(writeChunk);\n    });\n  });\n};\n\n/**\n * Writes some data. This method will work properly only if initialized with mode\n * \"w\" or \"w+\".\n *\n * @param string {string} The data to write.\n * @param close {boolean=false} opt_argument Closes this file after writing if\n *     true.\n * @param callback {function(*, GridStore)} This will be called after executing\n *     this method. The first parameter will contain null and the second one\n *     will contain a reference to this object.\n *\n * @ignore\n * @api private\n */\nvar writeBuffer = function(self, buffer, close, callback) {\n  if(typeof close === \"function\") { callback = close; close = null; }\n  var finalClose = typeof close == 'boolean' ? close : false;\n\n  if(self.mode[0] != \"w\") {\n    callback(new Error((self.referenceBy == REFERENCE_BY_ID ? self.toHexString() : self.filename) + \" not opened for writing\"), null);\n  } else {\n    if(self.currentChunk.position + buffer.length >= self.chunkSize) {\n      // Write out the current Chunk and then keep writing until we have less data left than a chunkSize left\n      // to a new chunk (recursively)\n      var previousChunkNumber = self.currentChunk.chunkNumber;\n      var leftOverDataSize = self.chunkSize - self.currentChunk.position;\n      var firstChunkData = buffer.slice(0, leftOverDataSize);\n      var leftOverData = buffer.slice(leftOverDataSize);\n      // A list of chunks to write out\n      var chunksToWrite = [self.currentChunk.write(firstChunkData)];\n      // If we have more data left than the chunk size let's keep writing new chunks\n      while(leftOverData.length >= self.chunkSize) {\n        // Create a new chunk and write to it\n        var newChunk = new Chunk(self, {'n': (previousChunkNumber + 1)}, self.writeConcern);\n        var firstChunkData = leftOverData.slice(0, self.chunkSize);\n        leftOverData = leftOverData.slice(self.chunkSize);\n        // Update chunk number\n        previousChunkNumber = previousChunkNumber + 1;\n        // Write data\n        newChunk.write(firstChunkData);\n        // Push chunk to save list\n        chunksToWrite.push(newChunk);\n      }\n\n      // Set current chunk with remaining data\n      self.currentChunk = new Chunk(self, {'n': (previousChunkNumber + 1)}, self.writeConcern);\n      // If we have left over data write it\n      if(leftOverData.length > 0) self.currentChunk.write(leftOverData);\n\n      // Update the position for the gridstore\n      self.position = self.position + buffer.length;\n      // Total number of chunks to write\n      var numberOfChunksToWrite = chunksToWrite.length;\n\n      for(var i = 0; i < chunksToWrite.length; i++) {\n        chunksToWrite[i].save({}, function(err, result) {\n          if(err) return callback(err);\n\n          numberOfChunksToWrite = numberOfChunksToWrite - 1;\n\n          if(numberOfChunksToWrite <= 0) {\n            // We care closing the file before returning\n            if(finalClose) {\n              return self.close(function(err, result) {\n                callback(err, self);\n              });\n            }\n            \n            // Return normally\n            return callback(null, self);\n          }\n        });\n      }\n    } else {\n      // Update the position for the gridstore\n      self.position = self.position + buffer.length;\n      // We have less data than the chunk size just write it and callback\n      self.currentChunk.write(buffer);\n      // We care closing the file before returning\n      if(finalClose) {\n        return self.close(function(err, result) {\n          callback(err, self);\n        });\n      }\n      // Return normally\n      return callback(null, self);\n    }\n  }\n};\n\n/**\n * Creates a mongoDB object representation of this object.\n *\n * @param callback {function(object)} This will be called after executing this\n *     method. The object will be passed to the first parameter and will have\n *     the structure:\n *\n *        <pre><code>\n *        {\n *          '_id' : , // {number} id for this file\n *          'filename' : , // {string} name for this file\n *          'contentType' : , // {string} mime type for this file\n *          'length' : , // {number} size of this file?\n *          'chunksize' : , // {number} chunk size used by this file\n *          'uploadDate' : , // {Date}\n *          'aliases' : , // {array of string}\n *          'metadata' : , // {string}\n *        }\n *        </code></pre>\n *\n * @ignore\n * @api private\n */\nvar buildMongoObject = function(self, callback) {\n  // Calcuate the length\n  var mongoObject = {\n    '_id': self.fileId,\n    'filename': self.filename,\n    'contentType': self.contentType,\n    'length': self.position ? self.position : 0,\n    'chunkSize': self.chunkSize,\n    'uploadDate': self.uploadDate,\n    'aliases': self.aliases,\n    'metadata': self.metadata\n  };\n\n  var md5Command = {filemd5:self.fileId, root:self.root};\n  self.db.command(md5Command, function(err, results) {\n    if(err) return callback(err);\n\n    mongoObject.md5 = results.md5;\n    callback(null, mongoObject);\n  });\n};\n\n/**\n * Saves this file to the database. This will overwrite the old entry if it\n * already exists. This will work properly only if mode was initialized to\n * \"w\" or \"w+\".\n *\n * @param {Function} callback this will be called after executing this method. Passes an **{Error}** object to the first parameter and null to the second if an error occured. Otherwise, passes null to the first and a reference to this object to the second.\n * @return {null}\n * @api public\n */\nGridStore.prototype.close = function(callback) {\n  var self = this;\n\n  if(self.mode[0] == \"w\") {\n    // Set up options\n    var options = self.writeConcern;\n\n    if(self.currentChunk != null && self.currentChunk.position > 0) {\n      self.currentChunk.save({}, function(err, chunk) {\n        if(err && typeof callback == 'function') return callback(err);\n\n        self.collection(function(err, files) {\n          if(err && typeof callback == 'function') return callback(err);\n\n          // Build the mongo object\n          if(self.uploadDate != null) {\n            files.remove({'_id':self.fileId}, self.writeConcern, function(err, collection) {\n              if(err && typeof callback == 'function') return callback(err);\n\n              buildMongoObject(self, function(err, mongoObject) {\n                if(err) {\n                  if(typeof callback == 'function') return callback(err); else throw err;\n                }\n\n                files.save(mongoObject, options, function(err) {\n                  if(typeof callback == 'function')\n                    callback(err, mongoObject);\n                });\n              });\n            });\n          } else {\n            self.uploadDate = new Date();\n            buildMongoObject(self, function(err, mongoObject) {\n              if(err) {\n                if(typeof callback == 'function') return callback(err); else throw err;\n              }\n\n              files.save(mongoObject, options, function(err) {\n                if(typeof callback == 'function')\n                  callback(err, mongoObject);\n              });\n            });\n          }\n        });\n      });\n    } else {\n      self.collection(function(err, files) {\n        if(err && typeof callback == 'function') return callback(err);\n\n        self.uploadDate = new Date();\n        buildMongoObject(self, function(err, mongoObject) {\n          if(err) {\n            if(typeof callback == 'function') return callback(err); else throw err;\n          }\n\n          files.save(mongoObject, options, function(err) {\n            if(typeof callback == 'function')\n              callback(err, mongoObject);\n          });\n        });\n      });\n    }\n  } else if(self.mode[0] == \"r\") {\n    if(typeof callback == 'function')\n      callback(null, null);\n  } else {\n    if(typeof callback == 'function')\n      callback(new Error(\"Illegal mode \" + self.mode), null);\n  }\n};\n\n/**\n * Gets the nth chunk of this file.\n *\n * @param chunkNumber {number} The nth chunk to retrieve.\n * @param callback {function(*, Chunk|object)} This will be called after\n *     executing this method. null will be passed to the first parameter while\n *     a new {@link Chunk} instance will be passed to the second parameter if\n *     the chunk was found or an empty object {} if not.\n *\n * @ignore\n * @api private\n */\nvar nthChunk = function(self, chunkNumber, options, callback) {\n  if(typeof options == 'function') {\n    callback = options;\n    options = {};\n  }\n\n  options = options || self.writeConcern;\n  options.readPreference = self.readPreference;\n  // Get the nth chunk\n  self.chunkCollection().find({'files_id':self.fileId, 'n':chunkNumber}, options, function(err, cursor) {\n    if(err) return callback(err);\n\n    cursor.nextObject(function(err, chunk) {\n      if(err) return callback(err);\n\n      var finalChunk = chunk == null ? {} : chunk;\n      callback(null, new Chunk(self, finalChunk, self.writeConcern));\n    });\n  });\n};\n\n/**\n *\n * @ignore\n * @api private\n */\nGridStore.prototype._nthChunk = function(chunkNumber, callback) {\n  nthChunk(this, chunkNumber, callback);\n}\n\n/**\n * @return {Number} The last chunk number of this file.\n *\n * @ignore\n * @api private\n */\nvar lastChunkNumber = function(self) {\n  return Math.floor((self.length ? self.length - 1 : 0)/self.chunkSize);\n};\n\n/**\n * Retrieve this file's chunks collection.\n *\n * @param {Function} callback this will be called after executing this method. An exception object will be passed to the first parameter when an error occured or null otherwise. A new **{Collection}** object will be passed to the second parameter if no error occured.\n * @return {null}\n * @api public\n */\nGridStore.prototype.chunkCollection = function(callback) {\n  if(typeof callback == 'function')\n    return this.db.collection((this.root + \".chunks\"), callback);\n  return this.db.collection((this.root + \".chunks\"));\n};\n\n/**\n * Deletes all the chunks of this file in the database.\n *\n * @param callback {function(*, boolean)} This will be called after this method\n *     executes. Passes null to the first and true to the second argument.\n *\n * @ignore\n * @api private\n */\nvar deleteChunks = function(self, options, callback) {\n  if(typeof options == 'function') {\n    callback = options;\n    options = {};\n  }\n\n  options = options || self.writeConcern;\n\n  if(self.fileId != null) {\n    self.chunkCollection().remove({'files_id':self.fileId}, options, function(err, result) {\n      if(err) return callback(err, false);\n      callback(null, true);\n    });\n  } else {\n    callback(null, true);\n  }\n};\n\n/**\n * Deletes all the chunks of this file in the database.\n *\n * @param {Function} callback this will be called after this method executes. Passes null to the first and true to the second argument.\n * @return {null}\n * @api public\n */\nGridStore.prototype.unlink = function(callback) {\n  var self = this;\n  deleteChunks(this, function(err) {\n    if(err!==null) {\n      err.message = \"at deleteChunks: \" + err.message;\n      return callback(err);\n    }\n\n    self.collection(function(err, collection) {\n      if(err!==null) {\n        err.message = \"at collection: \" + err.message;\n        return callback(err);\n      }\n\n      collection.remove({'_id':self.fileId}, self.writeConcern, function(err) {\n        callback(err, self);\n      });\n    });\n  });\n};\n\n/**\n * Retrieves the file collection associated with this object.\n *\n * @param {Function} callback this will be called after executing this method. An exception object will be passed to the first parameter when an error occured or null otherwise. A new **{Collection}** object will be passed to the second parameter if no error occured.\n * @return {null}\n * @api public\n */\nGridStore.prototype.collection = function(callback) {\n  if(typeof callback == 'function')\n    this.db.collection(this.root + \".files\", callback);\n  return this.db.collection(this.root + \".files\");\n};\n\n/**\n * Reads the data of this file.\n *\n * @param {String} [separator] the character to be recognized as the newline separator.\n * @param {Function} callback This will be called after this method is executed. The first parameter will be null and the second parameter will contain an array of strings representing the entire data, each element representing a line including the separator character.\n * @return {null}\n * @api public\n */\nGridStore.prototype.readlines = function(separator, callback) {\n  var args = Array.prototype.slice.call(arguments, 0);\n  callback = args.pop();\n  separator = args.length ? args.shift() : \"\\n\";\n\n  this.read(function(err, data) {\n    if(err) return callback(err);\n\n    var items = data.toString().split(separator);\n    items = items.length > 0 ? items.splice(0, items.length - 1) : [];\n    for(var i = 0; i < items.length; i++) {\n      items[i] = items[i] + separator;\n    }\n\n    callback(null, items);\n  });\n};\n\n/**\n * Deletes all the chunks of this file in the database if mode was set to \"w\" or\n * \"w+\" and resets the read/write head to the initial position.\n *\n * @param {Function} callback this will be called after executing this method. The first parameter will contain null and the second one will contain a reference to this object.\n * @return {null}\n * @api public\n */\nGridStore.prototype.rewind = function(callback) {\n  var self = this;\n\n  if(this.currentChunk.chunkNumber != 0) {\n    if(this.mode[0] == \"w\") {\n      deleteChunks(self, function(err, gridStore) {\n        if(err) return callback(err);\n        self.currentChunk = new Chunk(self, {'n': 0}, self.writeConcern);\n        self.position = 0;\n        callback(null, self);\n      });\n    } else {\n      self.currentChunk(0, function(err, chunk) {\n        if(err) return callback(err);\n        self.currentChunk = chunk;\n        self.currentChunk.rewind();\n        self.position = 0;\n        callback(null, self);\n      });\n    }\n  } else {\n    self.currentChunk.rewind();\n    self.position = 0;\n    callback(null, self);\n  }\n};\n\n/**\n * Retrieves the contents of this file and advances the read/write head. Works with Buffers only.\n *\n * There are 3 signatures for this method:\n *\n * (callback)\n * (length, callback)\n * (length, buffer, callback)\n *\n * @param {Number} [length] the number of characters to read. Reads all the characters from the read/write head to the EOF if not specified.\n * @param {String|Buffer} [buffer] a string to hold temporary data. This is used for storing the string data read so far when recursively calling this method.\n * @param {Function} callback this will be called after this method is executed. null will be passed to the first parameter and a string containing the contents of the buffer concatenated with the contents read from this file will be passed to the second.\n * @return {null}\n * @api public\n */\nGridStore.prototype.read = function(length, buffer, callback) {\n  var self = this;\n\n  var args = Array.prototype.slice.call(arguments, 0);\n  callback = args.pop();\n  length = args.length ? args.shift() : null;\n  buffer = args.length ? args.shift() : null;\n\n  // The data is a c-terminated string and thus the length - 1\n  var finalLength = length == null ? self.length - self.position : length;\n  var finalBuffer = buffer == null ? new Buffer(finalLength) : buffer;\n  // Add a index to buffer to keep track of writing position or apply current index\n  finalBuffer._index = buffer != null && buffer._index != null ? buffer._index : 0;\n\n  if((self.currentChunk.length() - self.currentChunk.position + finalBuffer._index) >= finalLength) {\n    var slice = self.currentChunk.readSlice(finalLength - finalBuffer._index);\n    // Copy content to final buffer\n    slice.copy(finalBuffer, finalBuffer._index);\n    // Update internal position\n    self.position = self.position + finalBuffer.length;\n    // Check if we don't have a file at all\n    if(finalLength == 0 && finalBuffer.length == 0) return callback(new Error(\"File does not exist\"), null);\n    // Else return data\n    callback(null, finalBuffer);\n  } else {\n    var slice = self.currentChunk.readSlice(self.currentChunk.length() - self.currentChunk.position);\n    // Copy content to final buffer\n    slice.copy(finalBuffer, finalBuffer._index);\n    // Update index position\n    finalBuffer._index += slice.length;\n\n    // Load next chunk and read more\n    nthChunk(self, self.currentChunk.chunkNumber + 1, function(err, chunk) {\n      if(err) return callback(err);\n\n      if(chunk.length() > 0) {\n        self.currentChunk = chunk;\n        self.read(length, finalBuffer, callback);\n      } else {\n        if (finalBuffer._index > 0) {\n          callback(null, finalBuffer)\n        } else {\n          callback(new Error(\"no chunks found for file, possibly corrupt\"), null);\n        }\n      }\n    });\n  }\n}\n\n/**\n * Retrieves the position of the read/write head of this file.\n *\n * @param {Function} callback This gets called after this method terminates. null is passed to the first parameter and the position is passed to the second.\n * @return {null}\n * @api public\n */\nGridStore.prototype.tell = function(callback) {\n  callback(null, this.position);\n};\n\n/**\n * Moves the read/write head to a new location.\n *\n * There are 3 signatures for this method\n *\n * Seek Location Modes\n *  - **GridStore.IO_SEEK_SET**, **(default)** set the position from the start of the file.\n *  - **GridStore.IO_SEEK_CUR**, set the position from the current position in the file.\n *  - **GridStore.IO_SEEK_END**, set the position from the end of the file.\n *\n * @param {Number} [position] the position to seek to\n * @param {Number} [seekLocation] seek mode. Use one of the Seek Location modes.\n * @param {Function} callback this will be called after executing this method. The first parameter will contain null and the second one will contain a reference to this object.\n * @return {null}\n * @api public\n */\nGridStore.prototype.seek = function(position, seekLocation, callback) {\n  var self = this;\n\n  var args = Array.prototype.slice.call(arguments, 1);\n  callback = args.pop();\n  seekLocation = args.length ? args.shift() : null;\n\n  var seekLocationFinal = seekLocation == null ? exports.GridStore.IO_SEEK_SET : seekLocation;\n  var finalPosition = position;\n  var targetPosition = 0;\n\n  // Calculate the position\n  if(seekLocationFinal == exports.GridStore.IO_SEEK_CUR) {\n    targetPosition = self.position + finalPosition;\n  } else if(seekLocationFinal == exports.GridStore.IO_SEEK_END) {\n    targetPosition = self.length + finalPosition;\n  } else {\n    targetPosition = finalPosition;\n  }\n\n  // Get the chunk\n  var newChunkNumber = Math.floor(targetPosition/self.chunkSize);\n  if(newChunkNumber != self.currentChunk.chunkNumber) {\n    var seekChunk = function() {\n      nthChunk(self, newChunkNumber, function(err, chunk) {\n        self.currentChunk = chunk;\n        self.position = targetPosition;\n        self.currentChunk.position = (self.position % self.chunkSize);\n        callback(err, self);\n      });\n    };\n\n    if(self.mode[0] == 'w') {\n      self.currentChunk.save({}, function(err) {\n        if(err) return callback(err);\n        seekChunk();\n      });\n    } else {\n      seekChunk();\n    }\n  } else {\n    self.position = targetPosition;\n    self.currentChunk.position = (self.position % self.chunkSize);\n    callback(null, self);\n  }\n};\n\n/**\n * Verify if the file is at EOF.\n *\n * @return {Boolean} true if the read/write head is at the end of this file.\n * @api public\n */\nGridStore.prototype.eof = function() {\n  return this.position == this.length ? true : false;\n};\n\n/**\n * Retrieves a single character from this file.\n *\n * @param {Function} callback this gets called after this method is executed. Passes null to the first parameter and the character read to the second or null to the second if the read/write head is at the end of the file.\n * @return {null}\n * @api public\n */\nGridStore.prototype.getc = function(callback) {\n  var self = this;\n\n  if(self.eof()) {\n    callback(null, null);\n  } else if(self.currentChunk.eof()) {\n    nthChunk(self, self.currentChunk.chunkNumber + 1, function(err, chunk) {\n      self.currentChunk = chunk;\n      self.position = self.position + 1;\n      callback(err, self.currentChunk.getc());\n    });\n  } else {\n    self.position = self.position + 1;\n    callback(null, self.currentChunk.getc());\n  }\n};\n\n/**\n * Writes a string to the file with a newline character appended at the end if\n * the given string does not have one.\n *\n * @param {String} string the string to write.\n * @param {Function} callback this will be called after executing this method. The first parameter will contain null and the second one will contain a reference to this object.\n * @return {null}\n * @api public\n */\nGridStore.prototype.puts = function(string, callback) {\n  var finalString = string.match(/\\n$/) == null ? string + \"\\n\" : string;\n  this.write(finalString, callback);\n};\n\n/**\n * Returns read stream based on this GridStore file\n *\n * Events\n *  - **data** {function(item) {}} the data event triggers when a document is ready.\n *  - **end** {function() {}} the end event triggers when there is no more documents available.\n *  - **close** {function() {}} the close event triggers when the stream is closed.\n *  - **error** {function(err) {}} the error event triggers if an error happens.\n *\n * @param {Boolean} autoclose if true current GridStore will be closed when EOF and 'close' event will be fired\n * @return {null}\n * @api public\n */\nGridStore.prototype.stream = function(autoclose) {\n  return new ReadStream(autoclose, this);\n};\n\n/**\n* The collection to be used for holding the files and chunks collection.\n*\n* @classconstant DEFAULT_ROOT_COLLECTION\n**/\nGridStore.DEFAULT_ROOT_COLLECTION = 'fs';\n\n/**\n* Default file mime type\n*\n* @classconstant DEFAULT_CONTENT_TYPE\n**/\nGridStore.DEFAULT_CONTENT_TYPE = 'binary/octet-stream';\n\n/**\n* Seek mode where the given length is absolute.\n*\n* @classconstant IO_SEEK_SET\n**/\nGridStore.IO_SEEK_SET = 0;\n\n/**\n* Seek mode where the given length is an offset to the current read/write head.\n*\n* @classconstant IO_SEEK_CUR\n**/\nGridStore.IO_SEEK_CUR = 1;\n\n/**\n* Seek mode where the given length is an offset to the end of the file.\n*\n* @classconstant IO_SEEK_END\n**/\nGridStore.IO_SEEK_END = 2;\n\n/**\n * Checks if a file exists in the database.\n *\n * Options\n *  - **readPreference** {String}, the prefered read preference (ReadPreference.PRIMARY, ReadPreference.PRIMARY_PREFERRED, ReadPreference.SECONDARY, ReadPreference.SECONDARY_PREFERRED, ReadPreference.NEAREST).\n *\n * @param {Db} db the database to query.\n * @param {String} name the name of the file to look for.\n * @param {String} [rootCollection] the root collection that holds the files and chunks collection. Defaults to **{GridStore.DEFAULT_ROOT_COLLECTION}**.\n * @param {Function} callback this will be called after this method executes. Passes null to the first and passes true to the second if the file exists and false otherwise.\n * @return {null}\n * @api public\n */\nGridStore.exist = function(db, fileIdObject, rootCollection, options, callback) {\n  var args = Array.prototype.slice.call(arguments, 2);\n  callback = args.pop();\n  rootCollection = args.length ? args.shift() : null;\n  options = args.length ? args.shift() : {};\n\n  // Establish read preference\n  var readPreference = options.readPreference || 'primary';\n  // Fetch collection\n  var rootCollectionFinal = rootCollection != null ? rootCollection : GridStore.DEFAULT_ROOT_COLLECTION;\n  db.collection(rootCollectionFinal + \".files\", function(err, collection) {\n    if(err) return callback(err);\n\n    // Build query\n    var query = (typeof fileIdObject == 'string' || Object.prototype.toString.call(fileIdObject) == '[object RegExp]' )\n      ? {'filename':fileIdObject}\n      : {'_id':fileIdObject};    // Attempt to locate file\n\n    collection.find(query, {readPreference:readPreference}, function(err, cursor) {\n      if(err) return callback(err);\n\n      cursor.nextObject(function(err, item) {\n        if(err) return callback(err);\n        callback(null, item == null ? false : true);\n      });\n    });\n  });\n};\n\n/**\n * Gets the list of files stored in the GridFS.\n *\n * @param {Db} db the database to query.\n * @param {String} [rootCollection] the root collection that holds the files and chunks collection. Defaults to **{GridStore.DEFAULT_ROOT_COLLECTION}**.\n * @param {Function} callback this will be called after this method executes. Passes null to the first and passes an array of strings containing the names of the files.\n * @return {null}\n * @api public\n */\nGridStore.list = function(db, rootCollection, options, callback) {\n  var args = Array.prototype.slice.call(arguments, 1);\n  callback = args.pop();\n  rootCollection = args.length ? args.shift() : null;\n  options = args.length ? args.shift() : {};\n\n  // Ensure we have correct values\n  if(rootCollection != null && typeof rootCollection == 'object') {\n    options = rootCollection;\n    rootCollection = null;\n  }\n\n  // Establish read preference\n  var readPreference = options.readPreference || 'primary';\n  // Check if we are returning by id not filename\n  var byId = options['id'] != null ? options['id'] : false;\n  // Fetch item\n  var rootCollectionFinal = rootCollection != null ? rootCollection : GridStore.DEFAULT_ROOT_COLLECTION;\n  var items = [];\n  db.collection((rootCollectionFinal + \".files\"), function(err, collection) {\n    if(err) return callback(err);\n\n    collection.find({}, {readPreference:readPreference}, function(err, cursor) {\n      if(err) return callback(err);\n\n      cursor.each(function(err, item) {\n        if(item != null) {\n          items.push(byId ? item._id : item.filename);\n        } else {\n          callback(err, items);\n        }\n      });\n    });\n  });\n};\n\n/**\n * Reads the contents of a file.\n *\n * This method has the following signatures\n *\n * (db, name, callback)\n * (db, name, length, callback)\n * (db, name, length, offset, callback)\n * (db, name, length, offset, options, callback)\n *\n * @param {Db} db the database to query.\n * @param {String} name the name of the file.\n * @param {Number} [length] the size of data to read.\n * @param {Number} [offset] the offset from the head of the file of which to start reading from.\n * @param {Object} [options] the options for the file.\n * @param {Function} callback this will be called after this method executes. A string with an error message will be passed to the first parameter when the length and offset combination exceeds the length of the file while an Error object will be passed if other forms of error occured, otherwise, a string is passed. The second parameter will contain the data read if successful or null if an error occured.\n * @return {null}\n * @api public\n */\nGridStore.read = function(db, name, length, offset, options, callback) {\n  var args = Array.prototype.slice.call(arguments, 2);\n  callback = args.pop();\n  length = args.length ? args.shift() : null;\n  offset = args.length ? args.shift() : null;\n  options = args.length ? args.shift() : null;\n\n  new GridStore(db, name, \"r\", options).open(function(err, gridStore) {\n    if(err) return callback(err);\n    // Make sure we are not reading out of bounds\n    if(offset && offset >= gridStore.length) return callback(\"offset larger than size of file\", null);\n    if(length && length > gridStore.length) return callback(\"length is larger than the size of the file\", null);\n    if(offset && length && (offset + length) > gridStore.length) return callback(\"offset and length is larger than the size of the file\", null);\n\n    if(offset != null) {\n      gridStore.seek(offset, function(err, gridStore) {\n        if(err) return callback(err);\n        gridStore.read(length, callback);\n      });\n    } else {\n      gridStore.read(length, callback);\n    }\n  });\n};\n\n/**\n * Reads the data of this file.\n *\n * @param {Db} db the database to query.\n * @param {String} name the name of the file.\n * @param {String} [separator] the character to be recognized as the newline separator.\n * @param {Object} [options] file options.\n * @param {Function} callback this will be called after this method is executed. The first parameter will be null and the second parameter will contain an array of strings representing the entire data, each element representing a line including the separator character.\n * @return {null}\n * @api public\n */\nGridStore.readlines = function(db, name, separator, options, callback) {\n  var args = Array.prototype.slice.call(arguments, 2);\n  callback = args.pop();\n  separator = args.length ? args.shift() : null;\n  options = args.length ? args.shift() : null;\n\n  var finalSeperator = separator == null ? \"\\n\" : separator;\n  new GridStore(db, name, \"r\", options).open(function(err, gridStore) {\n    if(err) return callback(err);\n    gridStore.readlines(finalSeperator, callback);\n  });\n};\n\n/**\n * Deletes the chunks and metadata information of a file from GridFS.\n *\n * @param {Db} db the database to interact with.\n * @param {String|Array} names the name/names of the files to delete.\n * @param {Object} [options] the options for the files.\n * @callback {Function} this will be called after this method is executed. The first parameter will contain an Error object if an error occured or null otherwise. The second parameter will contain a reference to this object.\n * @return {null}\n * @api public\n */\nGridStore.unlink = function(db, names, options, callback) {\n  var self = this;\n  var args = Array.prototype.slice.call(arguments, 2);\n  callback = args.pop();\n  options = args.length ? args.shift() : {};\n\n  // Get the write concern\n  var writeConcern = _getWriteConcern(db, options);\n\n  // List of names\n  if(names.constructor == Array) {\n    var tc = 0;\n    for(var i = 0; i < names.length; i++) {\n      ++tc;\n      GridStore.unlink(db, names[i], options, function(result) {\n        if(--tc == 0) {\n            callback(null, self);\n        }\n      });\n    }\n  } else {\n    new GridStore(db, names, \"w\", options).open(function(err, gridStore) {\n      if(err) return callback(err);\n      deleteChunks(gridStore, function(err, result) {\n        if(err) return callback(err);\n        gridStore.collection(function(err, collection) {\n          if(err) return callback(err);\n          collection.remove({'_id':gridStore.fileId}, writeConcern, function(err, result) {\n            callback(err, self);\n          });\n        });\n      });\n    });\n  }\n};\n\n/**\n * Returns the current chunksize of the file.\n *\n * @field chunkSize\n * @type {Number}\n * @getter\n * @setter\n * @property return number of bytes in the current chunkSize.\n */\nObject.defineProperty(GridStore.prototype, \"chunkSize\", { enumerable: true\n , get: function () {\n     return this.internalChunkSize;\n   }\n , set: function(value) {\n     if(!(this.mode[0] == \"w\" && this.position == 0 && this.uploadDate == null)) {\n       this.internalChunkSize = this.internalChunkSize;\n     } else {\n       this.internalChunkSize = value;\n     }\n   }\n});\n\n/**\n * The md5 checksum for this file.\n *\n * @field md5\n * @type {Number}\n * @getter\n * @setter\n * @property return this files md5 checksum.\n */\nObject.defineProperty(GridStore.prototype, \"md5\", { enumerable: true\n , get: function () {\n     return this.internalMd5;\n   }\n});\n\n/**\n *  GridStore Streaming methods\n *  Handles the correct return of the writeable stream status\n *  @ignore\n */\nObject.defineProperty(GridStore.prototype, \"writable\", { enumerable: true\n , get: function () {\n    if(this._writeable == null) {\n      this._writeable = this.mode != null && this.mode.indexOf(\"w\") != -1;\n    }\n    // Return the _writeable\n    return this._writeable;\n  }\n , set: function(value) {\n    this._writeable = value;\n  }\n});\n\n/**\n *  Handles the correct return of the readable stream status\n *  @ignore\n */\nObject.defineProperty(GridStore.prototype, \"readable\", { enumerable: true\n , get: function () {\n    if(this._readable == null) {\n      this._readable = this.mode != null && this.mode.indexOf(\"r\") != -1;\n    }\n    return this._readable;\n  }\n , set: function(value) {\n    this._readable = value;\n  }\n});\n\nGridStore.prototype.paused;\n\n/**\n *  Handles the correct setting of encoding for the stream\n *  @ignore\n */\nGridStore.prototype.setEncoding = fs.ReadStream.prototype.setEncoding;\n\n/**\n *  Handles the end events\n *  @ignore\n */\nGridStore.prototype.end = function end(data) {\n  var self = this;\n  // allow queued data to write before closing\n  if(!this.writable) return;\n  this.writable = false;\n\n  if(data) {\n    this._q.push(data);\n  }\n\n  this.on('drain', function () {\n    self.close(function (err) {\n      if (err) return _error(self, err);\n      self.emit('close');\n    });\n  });\n\n  _flush(self);\n}\n\n/**\n *  Handles the normal writes to gridstore\n *  @ignore\n */\nvar _writeNormal = function(self, data, close, callback) {\n  // If we have a buffer write it using the writeBuffer method\n  if(Buffer.isBuffer(data)) {\n    return writeBuffer(self, data, close, callback);\n  } else {\n    return writeBuffer(self, new Buffer(data, 'binary'), close, callback);\n  }\n}\n\n/**\n * Writes some data. This method will work properly only if initialized with mode \"w\" or \"w+\".\n *\n * @param {String|Buffer} data the data to write.\n * @param {Boolean} [close] closes this file after writing if set to true.\n * @param {Function} callback this will be called after executing this method. The first parameter will contain null and the second one will contain a reference to this object.\n * @return {null}\n * @api public\n */\nGridStore.prototype.write = function write(data, close, callback) {\n  // If it's a normal write delegate the call\n  if(typeof close == 'function' || typeof callback == 'function') {\n    return _writeNormal(this, data, close, callback);\n  }\n\n  // Otherwise it's a stream write\n  var self = this;\n  if (!this.writable) {\n    throw new Error('GridWriteStream is not writable');\n  }\n\n  // queue data until we open.\n  if(!this._opened) {\n    // Set up a queue to save data until gridstore object is ready\n    this._q = [];\n    _openStream(self);\n    this._q.push(data);\n    return false;\n  }\n\n  // Push data to queue\n  this._q.push(data);\n  _flush(this);\n  // Return write successful\n  return true;\n}\n\n/**\n *  Handles the destroy part of a stream\n *  @ignore\n */\nGridStore.prototype.destroy = function destroy() {\n  // close and do not emit any more events. queued data is not sent.\n  if(!this.writable) return;\n  this.readable = false;\n  if(this.writable) {\n    this.writable = false;\n    this._q.length = 0;\n    this.emit('close');\n  }\n}\n\n/**\n *  Handles the destroySoon part of a stream\n *  @ignore\n */\nGridStore.prototype.destroySoon = function destroySoon() {\n  // as soon as write queue is drained, destroy.\n  // may call destroy immediately if no data is queued.\n  if(!this._q.length) {\n    return this.destroy();\n  }\n  this._destroying = true;\n}\n\n/**\n *  Handles the pipe part of the stream\n *  @ignore\n */\nGridStore.prototype.pipe = function(destination, options) {\n  var self = this;\n  // Open the gridstore\n  this.open(function(err, result) {\n    if(err) _errorRead(self, err);\n    if(!self.readable) return;\n    // Set up the pipe\n    self._pipe(destination, options);\n    // Emit the stream is open\n    self.emit('open');\n    // Read from the stream\n    _read(self);\n  })\n}\n\n/**\n *  Internal module methods\n *  @ignore\n */\nvar _read = function _read(self) {\n  if (!self.readable || self.paused || self.reading) {\n    return;\n  }\n\n  self.reading = true;\n  var stream = self._stream = self.stream();\n  stream.paused = self.paused;\n\n  stream.on('data', function (data) {\n    if (self._decoder) {\n      var str = self._decoder.write(data);\n      if (str.length) self.emit('data', str);\n    } else {\n      self.emit('data', data);\n    }\n  });\n\n  stream.on('end', function (data) {\n    self.emit('end', data);\n  });\n\n  stream.on('error', function (data) {\n    _errorRead(self, data);\n  });\n\n  stream.on('close', function (data) {\n    self.emit('close', data);\n  });\n\n  self.pause = function () {\n    // native doesn't always pause.\n    // bypass its pause() method to hack it\n    self.paused = stream.paused = true;\n  }\n\n  self.resume = function () {\n    if(!self.paused) return;\n\n    self.paused = false;\n    stream.resume();\n    self.readable = stream.readable;\n  }\n\n  self.destroy = function () {\n    self.readable = false;\n    stream.destroy();\n  }\n}\n\n/**\n * pause\n * @ignore\n */\nGridStore.prototype.pause = function pause () {\n  // Overridden when the GridStore opens.\n  this.paused = true;\n}\n\n/**\n * resume\n * @ignore\n */\nGridStore.prototype.resume = function resume () {\n  // Overridden when the GridStore opens.\n  this.paused = false;\n}\n\n/**\n *  Internal module methods\n *  @ignore\n */\nvar _flush = function _flush(self, _force) {\n  if (!self._opened) return;\n  if (!_force && self._flushing) return;\n  self._flushing = true;\n\n  // write the entire q to gridfs\n  if (!self._q.length) {\n    self._flushing = false;\n    self.emit('drain');\n\n    if(self._destroying) {\n      self.destroy();\n    }\n    return;\n  }\n\n  self.write(self._q.shift(), function (err, store) {\n    if (err) return _error(self, err);\n    self.emit('progress', store.position);\n    _flush(self, true);\n  });\n}\n\nvar _openStream = function _openStream (self) {\n  if(self._opening == true) return;\n  self._opening = true;\n\n  // Open the store\n  self.open(function (err, gridstore) {\n    if (err) return _error(self, err);\n    self._opened = true;\n    self.emit('open');\n    _flush(self);\n  });\n}\n\nvar _error = function _error(self, err) {\n  self.destroy();\n  self.emit('error', err);\n}\n\nvar _errorRead = function _errorRead (self, err) {\n  self.readable = false;\n  self.emit('error', err);\n}\n\n/**\n * @ignore\n */\nvar _hasWriteConcern = function(errorOptions) {\n  return errorOptions == true\n    || errorOptions.w > 0\n    || errorOptions.w == 'majority'\n    || errorOptions.j == true\n    || errorOptions.journal == true\n    || errorOptions.fsync == true\n}\n\n/**\n * @ignore\n */\nvar _setWriteConcernHash = function(options) {\n  var finalOptions = {};\n  if(options.w != null) finalOptions.w = options.w;  \n  if(options.journal == true) finalOptions.j = options.journal;\n  if(options.j == true) finalOptions.j = options.j;\n  if(options.fsync == true) finalOptions.fsync = options.fsync;\n  if(options.wtimeout != null) finalOptions.wtimeout = options.wtimeout;  \n  return finalOptions;\n}\n\n/**\n * @ignore\n */\nvar _getWriteConcern = function(self, options) {\n  // Final options\n  var finalOptions = {w:1};\n  options = options || {};\n\n  // Local options verification\n  if(options.w != null || typeof options.j == 'boolean' || typeof options.journal == 'boolean' || typeof options.fsync == 'boolean') {\n    finalOptions = _setWriteConcernHash(options);\n  } else if(options.safe != null && typeof options.safe == 'object') {\n    finalOptions = _setWriteConcernHash(options.safe);\n  } else if(typeof options.safe == \"boolean\") {\n    finalOptions = {w: (options.safe ? 1 : 0)};\n  } else if(self.options.w != null || typeof self.options.j == 'boolean' || typeof self.options.journal == 'boolean' || typeof self.options.fsync == 'boolean') {\n    finalOptions = _setWriteConcernHash(self.options);\n  } else if(self.safe.w != null || typeof self.safe.j == 'boolean' || typeof self.safe.journal == 'boolean' || typeof self.safe.fsync == 'boolean') {\n    finalOptions = _setWriteConcernHash(self.safe);\n  } else if(typeof self.safe == \"boolean\") {\n    finalOptions = {w: (self.safe ? 1 : 0)};\n  }\n\n  // Ensure we don't have an invalid combination of write concerns\n  if(finalOptions.w < 1 \n    && (finalOptions.journal == true || finalOptions.j == true || finalOptions.fsync == true)) throw new Error(\"No acknowledgement using w < 1 cannot be combined with journal:true or fsync:true\");\n\n  // Return the options\n  return finalOptions;\n}\n\n/**\n * @ignore\n * @api private\n */\nexports.GridStore = GridStore;\n"]}