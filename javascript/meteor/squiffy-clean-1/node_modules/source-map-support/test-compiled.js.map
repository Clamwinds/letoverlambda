{"version":3,"sources":["test.js"],"names":[],"mappings":"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","file":"test-compiled.js","sourcesContent":["require('./source-map-support').install({\n  emptyCacheBetweenOperations: true // Needed to be able to test for failure\n});\n\nvar SourceMapGenerator = require('source-map').SourceMapGenerator;\nvar child_process = require('child_process');\nvar assert = require('assert');\nvar fs = require('fs');\n\nfunction compareLines(actual, expected) {\n  assert(actual.length >= expected.length, 'got ' + actual.length + ' lines but expected at least ' + expected.length + ' lines');\n  for (var i = 0; i < expected.length; i++) {\n    // Some tests are regular expressions because the output format changed slightly between node v0.9.2 and v0.9.3\n    if (expected[i] instanceof RegExp) {\n      assert(expected[i].test(actual[i]), JSON.stringify(actual[i]) + ' does not match ' + expected[i]);\n    } else {\n      assert.equal(actual[i], expected[i]);\n    }\n  }\n}\n\nfunction createEmptySourceMap() {\n  return new SourceMapGenerator({\n    file: '.generated.js',\n    sourceRoot: '.'\n  });\n}\n\nfunction createSourceMapWithGap() {\n  var sourceMap = createEmptySourceMap();\n  sourceMap.addMapping({\n    generated: { line: 100, column: 0 },\n    original: { line: 100, column: 0 },\n    source: '.original.js'\n  });\n  return sourceMap;\n}\n\nfunction createSingleLineSourceMap() {\n  var sourceMap = createEmptySourceMap();\n  sourceMap.addMapping({\n    generated: { line: 1, column: 0 },\n    original: { line: 1, column: 0 },\n    source: '.original.js'\n  });\n  return sourceMap;\n}\n\nfunction createMultiLineSourceMap() {\n  var sourceMap = createEmptySourceMap();\n  for (var i = 1; i <= 100; i++) {\n    sourceMap.addMapping({\n      generated: { line: i, column: 0 },\n      original: { line: 1000 + i, column: 99 + i },\n      source: 'line' + i + '.js'\n    });\n  }\n  return sourceMap;\n}\n\nfunction createMultiLineSourceMapWithSourcesContent() {\n  var sourceMap = createEmptySourceMap();\n  var original = new Array(1001).join('\\n');\n  for (var i = 1; i <= 100; i++) {\n    sourceMap.addMapping({\n      generated: { line: i, column: 0 },\n      original: { line: 1000 + i, column: 4 },\n      source: 'original.js'\n    });\n    original += '    line ' + i + '\\n';\n  }\n  sourceMap.setSourceContent('original.js', original);\n  return sourceMap;\n}\n\nfunction compareStackTrace(sourceMap, source, expected) {\n  // Check once with a separate source map\n  fs.writeFileSync('.generated.js.map', sourceMap);\n  fs.writeFileSync('.generated.js', 'exports.test = function() {' +\n    source.join('\\n') + '};//@ sourceMappingURL=.generated.js.map');\n  try {\n    delete require.cache[require.resolve('./.generated')];\n    require('./.generated').test();\n  } catch (e) {\n    compareLines(e.stack.split('\\n'), expected);\n  }\n  fs.unlinkSync('.generated.js');\n  fs.unlinkSync('.generated.js.map');\n\n  // Check again with an inline source map (in a data URL)\n  fs.writeFileSync('.generated.js', 'exports.test = function() {' +\n    source.join('\\n') + '};//@ sourceMappingURL=data:application/json;base64,' +\n    new Buffer(sourceMap.toString()).toString('base64'));\n  try {\n    delete require.cache[require.resolve('./.generated')];\n    require('./.generated').test();\n  } catch (e) {\n    compareLines(e.stack.split('\\n'), expected);\n  }\n  fs.unlinkSync('.generated.js');\n}\n\nfunction compareStdout(done, sourceMap, source, expected) {\n  fs.writeFileSync('.original.js', 'this is the original code');\n  fs.writeFileSync('.generated.js.map', sourceMap);\n  fs.writeFileSync('.generated.js', source.join('\\n') +\n    '//@ sourceMappingURL=.generated.js.map');\n  child_process.exec('node ./.generated', function(error, stdout, stderr) {\n    try {\n      compareLines((stdout + stderr).trim().split('\\n'), expected);\n    } catch (e) {\n      return done(e);\n    }\n    fs.unlinkSync('.generated.js');\n    fs.unlinkSync('.generated.js.map');\n    fs.unlinkSync('.original.js');\n    done();\n  });\n}\n\nit('normal throw', function() {\n  compareStackTrace(createMultiLineSourceMap(), [\n    'throw new Error(\"test\");'\n  ], [\n    'Error: test',\n    /^    at Object\\.exports\\.test \\(.*\\/line1\\.js:1001:101\\)$/\n  ]);\n});\n\nit('throw inside function', function() {\n  compareStackTrace(createMultiLineSourceMap(), [\n    'function foo() {',\n    '  throw new Error(\"test\");',\n    '}',\n    'foo();'\n  ], [\n    'Error: test',\n    /^    at foo \\(.*\\/line2\\.js:1002:102\\)$/,\n    /^    at Object\\.exports\\.test \\(.*\\/line4\\.js:1004:104\\)$/\n  ]);\n});\n\nit('throw inside function inside function', function() {\n  compareStackTrace(createMultiLineSourceMap(), [\n    'function foo() {',\n    '  function bar() {',\n    '    throw new Error(\"test\");',\n    '  }',\n    '  bar();',\n    '}',\n    'foo();'\n  ], [\n    'Error: test',\n    /^    at bar \\(.*\\/line3\\.js:1003:103\\)$/,\n    /^    at foo \\(.*\\/line5\\.js:1005:105\\)$/,\n    /^    at Object\\.exports\\.test \\(.*\\/line7\\.js:1007:107\\)$/\n  ]);\n});\n\nit('eval', function() {\n  compareStackTrace(createMultiLineSourceMap(), [\n    'eval(\"throw new Error(\\'test\\')\");'\n  ], [\n    'Error: test',\n    /^    at Object\\.eval \\(eval at <anonymous> \\(.*\\/line1\\.js:1001:101\\)/,\n    /^    at Object\\.exports\\.test \\(.*\\/line1\\.js:1001:101\\)$/\n  ]);\n});\n\nit('eval inside eval', function() {\n  compareStackTrace(createMultiLineSourceMap(), [\n    'eval(\"eval(\\'throw new Error(\\\\\"test\\\\\")\\')\");'\n  ], [\n    'Error: test',\n    /^    at Object\\.eval \\(eval at <anonymous> \\(eval at <anonymous> \\(.*\\/line1\\.js:1001:101\\)/,\n    /^    at Object\\.eval \\(eval at <anonymous> \\(.*\\/line1\\.js:1001:101\\)/,\n    /^    at Object\\.exports\\.test \\(.*\\/line1\\.js:1001:101\\)$/\n  ]);\n});\n\nit('eval inside function', function() {\n  compareStackTrace(createMultiLineSourceMap(), [\n    'function foo() {',\n    '  eval(\"throw new Error(\\'test\\')\");',\n    '}',\n    'foo();'\n  ], [\n    'Error: test',\n    /^    at eval \\(eval at foo \\(.*\\/line2\\.js:1002:102\\)/,\n    /^    at foo \\(.*\\/line2\\.js:1002:102\\)/,\n    /^    at Object\\.exports\\.test \\(.*\\/line4\\.js:1004:104\\)$/\n  ]);\n});\n\nit('eval with sourceURL', function() {\n  compareStackTrace(createMultiLineSourceMap(), [\n    'eval(\"throw new Error(\\'test\\')//@ sourceURL=sourceURL.js\");'\n  ], [\n    'Error: test',\n    '    at Object.eval (sourceURL.js:1:7)',\n    /^    at Object\\.exports\\.test \\(.*\\/line1\\.js:1001:101\\)$/\n  ]);\n});\n\nit('eval with sourceURL inside eval', function() {\n  compareStackTrace(createMultiLineSourceMap(), [\n    'eval(\"eval(\\'throw new Error(\\\\\"test\\\\\")//@ sourceURL=sourceURL.js\\')\");'\n  ], [\n    'Error: test',\n    '    at Object.eval (sourceURL.js:1:7)',\n    /^    at Object\\.eval \\(eval at <anonymous> \\(.*\\/line1\\.js:1001:101\\)/,\n    /^    at Object\\.exports\\.test \\(.*\\/line1\\.js:1001:101\\)$/\n  ]);\n});\n\nit('function constructor', function() {\n  compareStackTrace(createMultiLineSourceMap(), [\n    'throw new Function(\")\");'\n  ], [\n    'SyntaxError: Unexpected token )',\n    /^    at Object\\.Function \\((?:unknown source|<anonymous>)\\)$/,\n    /^    at Object\\.exports\\.test \\(.*\\/line1\\.js:1001:101\\)$/,\n  ]);\n});\n\nit('throw with empty source map', function() {\n  compareStackTrace(createEmptySourceMap(), [\n    'throw new Error(\"test\");'\n  ], [\n    'Error: test',\n    /^    at Object\\.exports\\.test \\(.*\\/.generated.js:1:96\\)$/\n  ]);\n});\n\nit('throw with source map with gap', function() {\n  compareStackTrace(createSourceMapWithGap(), [\n    'throw new Error(\"test\");'\n  ], [\n    'Error: test',\n    /^    at Object\\.exports\\.test \\(.*\\/.generated.js:1:96\\)$/\n  ]);\n});\n\nit('sourcesContent with data URL', function() {\n  compareStackTrace(createMultiLineSourceMapWithSourcesContent(), [\n    'throw new Error(\"test\");'\n  ], [\n    'Error: test',\n    /^    at Object\\.exports\\.test \\(.*\\/original.js:1001:5\\)$/\n  ]);\n});\n\nit('default options', function(done) {\n  compareStdout(done, createSingleLineSourceMap(), [\n    '',\n    'function foo() { throw new Error(\"this is the error\"); }',\n    'require(\"./source-map-support\").install();',\n    'process.nextTick(foo);',\n    'process.nextTick(function() { process.exit(1); });'\n  ], [\n    /\\/.original\\.js:1$/,\n    'this is the original code',\n    '^',\n    'Error: this is the error',\n    /^    at foo \\(.*\\/.original\\.js:1:1\\)$/\n  ]);\n});\n\nit('handleUncaughtExceptions is true', function(done) {\n  compareStdout(done, createSingleLineSourceMap(), [\n    '',\n    'function foo() { throw new Error(\"this is the error\"); }',\n    'require(\"./source-map-support\").install({ handleUncaughtExceptions: true });',\n    'process.nextTick(foo);'\n  ], [\n    /\\/.original\\.js:1$/,\n    'this is the original code',\n    '^',\n    'Error: this is the error',\n    /^    at foo \\(.*\\/.original\\.js:1:1\\)$/\n  ]);\n});\n\nit('handleUncaughtExceptions is false', function(done) {\n  compareStdout(done, createSingleLineSourceMap(), [\n    '',\n    'function foo() { throw new Error(\"this is the error\"); }',\n    'require(\"./source-map-support\").install({ handleUncaughtExceptions: false });',\n    'process.nextTick(foo);'\n  ], [\n    /\\/.generated.js:2$/,\n    'function foo() { throw new Error(\"this is the error\"); }',\n    '                       ^',\n    'Error: this is the error',\n    /^    at foo \\(.*\\/.original\\.js:1:1\\)$/\n  ]);\n});\n\nit('default options with empty source map', function(done) {\n  compareStdout(done, createEmptySourceMap(), [\n    '',\n    'function foo() { throw new Error(\"this is the error\"); }',\n    'require(\"./source-map-support\").install();',\n    'process.nextTick(foo);'\n  ], [\n    /\\/.generated.js:2$/,\n    'function foo() { throw new Error(\"this is the error\"); }',\n    '                       ^',\n    'Error: this is the error',\n    /^    at foo \\(.*\\/.generated.js:2:24\\)$/\n  ]);\n});\n\nit('default options with source map with gap', function(done) {\n  compareStdout(done, createSourceMapWithGap(), [\n    '',\n    'function foo() { throw new Error(\"this is the error\"); }',\n    'require(\"./source-map-support\").install();',\n    'process.nextTick(foo);'\n  ], [\n    /\\/.generated.js:2$/,\n    'function foo() { throw new Error(\"this is the error\"); }',\n    '                       ^',\n    'Error: this is the error',\n    /^    at foo \\(.*\\/.generated.js:2:24\\)$/\n  ]);\n});\n\nit('specifically requested error source', function(done) {\n  compareStdout(done, createSingleLineSourceMap(), [\n    '',\n    'function foo() { throw new Error(\"this is the error\"); }',\n    'var sms = require(\"./source-map-support\");',\n    'sms.install({ handleUncaughtExceptions: false });',\n    'process.on(\"uncaughtException\", function (e) { console.log(\"SRC:\" + sms.getErrorSource(e)); });',\n    'process.nextTick(foo);'\n  ], [\n    'SRC:',\n    /\\/.original.js:1$/,\n    'this is the original code',\n    '^'\n  ]);\n});\n\nit('sourcesContent', function(done) {\n  compareStdout(done, createMultiLineSourceMapWithSourcesContent(), [\n    '',\n    'function foo() { throw new Error(\"this is the error\"); }',\n    'require(\"./source-map-support\").install();',\n    'process.nextTick(foo);',\n    'process.nextTick(function() { process.exit(1); });'\n  ], [\n    /\\/original\\.js:1002$/,\n    '    line 2',\n    '    ^',\n    'Error: this is the error',\n    /^    at foo \\(.*\\/original\\.js:1002:5\\)$/\n  ]);\n});\n\nit('missing source maps should also be cached', function(done) {\n  compareStdout(done, createSingleLineSourceMap(), [\n    '',\n    'var count = 0;',\n    'function foo() {',\n    '  console.log(new Error(\"this is the error\").stack.split(\"\\\\n\").slice(0, 2).join(\"\\\\n\"));',\n    '}',\n    'require(\"./source-map-support\").install({',\n    '  retrieveSourceMap: function(name) {',\n    '    if (/\\\\.generated.js$/.test(name)) count++;',\n    '    return null;',\n    '  }',\n    '});',\n    'process.nextTick(foo);',\n    'process.nextTick(foo);',\n    'process.nextTick(function() { console.log(count); });',\n  ], [\n    'Error: this is the error',\n    /^    at foo \\(.*\\/.generated.js:4:15\\)$/,\n    'Error: this is the error',\n    /^    at foo \\(.*\\/.generated.js:4:15\\)$/,\n    '1', // The retrieval should only be attempted once\n  ]);\n});\n"]}