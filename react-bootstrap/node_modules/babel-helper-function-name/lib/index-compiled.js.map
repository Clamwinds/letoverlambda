{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"babel-runtime/helpers/interop-require-default\")[\"default\"];\n\nvar _interopRequireWildcard = require(\"babel-runtime/helpers/interop-require-wildcard\")[\"default\"];\n\nexports.__esModule = true;\n\nvar _babelHelperGetFunctionArity = require(\"babel-helper-get-function-arity\");\n\nvar _babelHelperGetFunctionArity2 = _interopRequireDefault(_babelHelperGetFunctionArity);\n\nvar _babelTemplate = require(\"babel-template\");\n\nvar _babelTemplate2 = _interopRequireDefault(_babelTemplate);\n\nvar _babelTypes = require(\"babel-types\");\n\nvar t = _interopRequireWildcard(_babelTypes);\n\nvar buildPropertyMethodAssignmentWrapper = _babelTemplate2[\"default\"](\"\\n  (function (FUNCTION_KEY) {\\n    function FUNCTION_ID() {\\n      return FUNCTION_KEY.apply(this, arguments);\\n    }\\n\\n    FUNCTION_ID.toString = function () {\\n      return FUNCTION_KEY.toString();\\n    }\\n\\n    return FUNCTION_ID;\\n  })(FUNCTION)\\n\");\n\nvar buildGeneratorPropertyMethodAssignmentWrapper = _babelTemplate2[\"default\"](\"\\n  (function (FUNCTION_KEY) {\\n    function* FUNCTION_ID() {\\n      return yield* FUNCTION_KEY.apply(this, arguments);\\n    }\\n\\n    FUNCTION_ID.toString = function () {\\n      return FUNCTION_KEY.toString();\\n    };\\n\\n    return FUNCTION_ID;\\n  })(FUNCTION)\\n\");\n\nvar visitor = {\n  \"ReferencedIdentifier|BindingIdentifier\": function ReferencedIdentifierBindingIdentifier(path, state) {\n    // check if this node matches our function id\n    if (path.node.name !== state.name) return;\n\n    // check that we don't have a local variable declared as that removes the need\n    // for the wrapper\n    var localDeclar = path.scope.getBindingIdentifier(state.name);\n    if (localDeclar !== state.outerDeclar) return;\n\n    state.selfReference = true;\n    path.stop();\n  }\n};\n\nfunction wrap(state, method, id, scope) {\n  if (state.selfReference) {\n    if (scope.hasBinding(id.name) && !scope.hasGlobal(id.name)) {\n      // we can just munge the local binding\n      scope.rename(id.name);\n    } else {\n      // we don't currently support wrapping class expressions\n      if (!t.isFunction(method)) return;\n\n      // need to add a wrapper since we can't change the references\n      var build = buildPropertyMethodAssignmentWrapper;\n      if (method.generator) build = buildGeneratorPropertyMethodAssignmentWrapper;\n      var _template = build({\n        FUNCTION: method,\n        FUNCTION_ID: id,\n        FUNCTION_KEY: scope.generateUidIdentifier(id.name)\n      }).expression;\n      _template.callee._skipModulesRemap = true;\n\n      // shim in dummy params to retain function arity, if you try to read the\n      // source then you'll get the original since it's proxied so it's all good\n      var params = _template.callee.body.body[0].params;\n      for (var i = 0, len = _babelHelperGetFunctionArity2[\"default\"](method); i < len; i++) {\n        params.push(scope.generateUidIdentifier(\"x\"));\n      }\n\n      return _template;\n    }\n  }\n\n  method.id = id;\n  scope.getProgramParent().references[id.name] = true;\n}\n\nfunction visit(node, name, scope) {\n  var state = {\n    selfAssignment: false,\n    selfReference: false,\n    outerDeclar: scope.getBindingIdentifier(name),\n    references: [],\n    name: name\n  };\n\n  // check to see if we have a local binding of the id we're setting inside of\n  // the function, this is important as there are caveats associated\n\n  var binding = scope.getOwnBinding(name);\n\n  if (binding) {\n    if (binding.kind === \"param\") {\n      // safari will blow up in strict mode with code like:\n      //\n      //   let t = function t(t) {};\n      //\n      // with the error:\n      //\n      //   Cannot declare a parameter named 't' as it shadows the name of a\n      //   strict mode function.\n      //\n      // this isn't to the spec and they've invented this behaviour which is\n      // **extremely** annoying so we avoid setting the name if it has a param\n      // with the same id\n      state.selfReference = true;\n    } else {\n      // otherwise it's defined somewhere in scope like:\n      //\n      //   let t = function () {\n      //     let t = 2;\n      //   };\n      //\n      // so we can safely just set the id and move along as it shadows the\n      // bound function id\n    }\n  } else if (state.outerDeclar || scope.hasGlobal(name)) {\n      scope.traverse(node, visitor, state);\n    }\n\n  return state;\n}\n\nexports[\"default\"] = function (_ref) {\n  var node = _ref.node;\n  var parent = _ref.parent;\n  var scope = _ref.scope;\n  var id = _ref.id;\n\n  // has an `id` so we don't need to infer one\n  if (node.id) return;\n\n  if ((t.isObjectProperty(parent) || t.isObjectMethod(parent, { kind: \"method\" })) && (!parent.computed || t.isLiteral(parent.key))) {\n    // { foo() {} };\n    id = parent.key;\n  } else if (t.isVariableDeclarator(parent)) {\n    // let foo = function () {};\n    id = parent.id;\n\n    if (t.isIdentifier(id)) {\n      var binding = scope.parent.getBinding(id.name);\n      if (binding && binding.constant && scope.getBinding(id.name) === binding) {\n        // always going to reference this method\n        node.id = id;\n        return;\n      }\n    }\n  } else if (!id) {\n    return;\n  }\n\n  var name = undefined;\n  if (id && t.isLiteral(id)) {\n    name = id.value;\n  } else if (id && t.isIdentifier(id)) {\n    name = id.name;\n  } else {\n    return;\n  }\n\n  name = t.toBindingIdentifierName(name);\n  id = t.identifier(name);\n\n  var state = visit(node, name, scope);\n  return wrap(state, node, id, scope) || node;\n};\n\nmodule.exports = exports[\"default\"];"]}