{"version":3,"sources":["shadow-functions.js"],"names":[],"mappings":"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","file":"shadow-functions-compiled.js","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"babel-runtime/helpers/interop-require-default\")[\"default\"];\n\nvar _interopRequireWildcard = require(\"babel-runtime/helpers/interop-require-wildcard\")[\"default\"];\n\nexports.__esModule = true;\n\nvar _plugin = require(\"../plugin\");\n\nvar _plugin2 = _interopRequireDefault(_plugin);\n\nvar _babelTypes = require(\"babel-types\");\n\nvar t = _interopRequireWildcard(_babelTypes);\n\nexports[\"default\"] = new _plugin2[\"default\"]({\n  visitor: {\n    ThisExpression: function ThisExpression(path) {\n      remap(path, \"this\", function () {\n        return t.thisExpression();\n      });\n    },\n\n    ReferencedIdentifier: function ReferencedIdentifier(path) {\n      if (path.node.name === \"arguments\") {\n        remap(path, \"arguments\", function () {\n          return t.identifier(\"arguments\");\n        });\n      }\n    }\n  }\n});\n\nfunction shouldShadow(path, shadowPath) {\n  if (path.is(\"_forceShadow\")) {\n    return true;\n  } else {\n    return shadowPath && !shadowPath.isArrowFunctionExpression();\n  }\n}\n\nfunction remap(path, key, create) {\n  // ensure that we're shadowed\n  var shadowPath = path.inShadow(key);\n  if (!shouldShadow(path, shadowPath)) return;\n\n  var shadowFunction = path.node._shadowedFunctionLiteral;\n  var currentFunction = undefined;\n\n  var fnPath = path.findParent(function (path) {\n    if (path.isProgram() || path.isFunction()) {\n      // catch current function in case this is the shadowed one and we can ignore it\n      currentFunction = currentFunction || path;\n    }\n\n    if (path.isProgram()) {\n      return true;\n    } else if (path.isFunction()) {\n      if (shadowFunction) {\n        return path === shadowFunction || path.node === shadowFunction.node;\n      } else {\n        return !path.is(\"shadow\");\n      }\n    }\n\n    return false;\n  });\n\n  // no point in realiasing if we're in this function\n  if (fnPath === currentFunction) return;\n\n  var cached = fnPath.getData(key);\n  if (cached) return path.replaceWith(cached);\n\n  var init = create();\n  var id = path.scope.generateUidIdentifier(key);\n\n  fnPath.setData(key, id);\n  fnPath.scope.push({ id: id, init: init });\n\n  return path.replaceWith(id);\n}\nmodule.exports = exports[\"default\"];"]}